<!DOCTYPE html>
<html lang="de" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bingus & Amor's Trip V37 üöÄ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        rose: { 950: '#4c0519' }, 
                        neon: { green: '#39ff14', pink: '#ff00ff' }
                    },
                    fontFamily: {
                        sans: ['Quicksand', 'sans-serif'],
                        display: ['Fredoka', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slow': 'bounce 2s infinite',
                        'wobble': 'wobble 2s infinite ease-in-out',
                    },
                    keyframes: {
                        wobble: {
                            '0%, 100%': { transform: 'rotate(-2deg)' },
                            '50%': { transform: 'rotate(2deg)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Confetti JS -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">

    <style>
        body { 
            font-family: 'Quicksand', sans-serif; 
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Drunk Mode Global Overrides */
        body.drunk-mode {
            background-color: #000 !important;
            background-image: none !important;
            color: #39ff14 !important;
            font-family: 'Fredoka', cursive !important;
        }
        body.drunk-mode .map-tiles {
            filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
        }
        
        .bg-pattern-light {
            background-color: #fff1f2;
            background-image: 
                radial-gradient(at 10% 10%, rgba(253, 164, 175, 0.2) 0px, transparent 50%), 
                radial-gradient(at 90% 10%, rgba(251, 191, 36, 0.15) 0px, transparent 50%), 
                radial-gradient(at 50% 90%, rgba(52, 211, 153, 0.15) 0px, transparent 50%);
            background-attachment: fixed;
        }

        .bg-pattern-dark {
            background-color: #0f172a;
            background-image: 
                radial-gradient(at 10% 10%, rgba(76, 5, 25, 0.3) 0px, transparent 50%), 
                radial-gradient(at 90% 10%, rgba(56, 189, 248, 0.1) 0px, transparent 50%);
            background-attachment: fixed;
        }
        
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-enter { animation: modalPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        @keyframes modalPop { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        .card-hover { transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .card-hover:hover { transform: translateY(-4px) scale(1.01); box-shadow: 0 15px 30px -5px rgba(251, 113, 133, 0.2); z-index: 10; }

        .img-fallback {
            background-color: #ffe4e6;
            display: flex; align-items: center; justify-content: center;
            color: #fb7185; font-weight: 700; font-size: 1.5rem; letter-spacing: 0.05em;
            width: 100%; height: 100%;
        }
        .dark .img-fallback { background-color: #334155; color: #94a3b8; }
        
        #map-container { height: 65vh; width: 100%; border-radius: 1.5rem; z-index: 1; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border: 4px solid white; position: relative; }
        .dark #map-container { border-color: #1e293b; }
        
        .emoji-marker {
            display: flex; justify-content: center; align-items: center;
            font-size: 28px;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
            transition: transform 0.2s;
            cursor: pointer;
        }
        .emoji-marker:hover { transform: scale(1.3) translateY(-5px); z-index: 1000 !important; }
        
        .leaflet-popup-content-wrapper { border-radius: 16px; padding: 0; overflow: hidden; }
        .leaflet-popup-content { margin: 0; width: 260px !important; }
        .popup-content { padding: 12px; font-family: 'Quicksand', sans-serif; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #fda4af; border-radius: 20px; }
        .dark .custom-scroll::-webkit-scrollbar-thumb { background: #475569; }

        .beer-cursor { transition: left 1s linear; will-change: left; }
        .toast-enter { animation: toastUp 0.3s ease-out forwards; }
        @keyframes toastUp { from { opacity: 0; transform: translate(-50%, 20px); } to { opacity: 1; transform: translate(-50%, 0); } }
        
        /* Badges */
        .badge-res-high { background-color: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
        .badge-res-med { background-color: #ffedd5; color: #9a3412; border: 1px solid #fed7aa; }
        .badge-res-low { background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .dark .badge-res-high { background-color: #450a0a; color: #fecaca; border-color: #7f1d1d; }
        .dark .badge-res-med { background-color: #431407; color: #fed7aa; border-color: #7c2d12; }
        .dark .badge-res-low { background-color: #052e16; color: #bbf7d0; border-color: #14532d; }
    </style>
</head>
<body class="transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useRef, useEffect } = React;

        const FX_RATES = { 'HUF': 430, 'EUR': 1.06, 'CZK': 26 };

       
const DICTIONARY = {
    "Budapest": { 
        hello: "Szia", 
        cheers: "Eg√©szs√©gedre", 
        beer: "S√∂r", 
        thanks: "K√∂sz√∂n√∂m", 
        bill: "A sz√°ml√°t k√©rem",
        ass: "Segg",
        fuck: "Basszus",
        drunk: "R√©szeg vagyok",
        cool: "Nagyon j√≥",
        sexy: "Szexi",
        hungry: "√âhes vagyok",
        thirsty: "Szomjas vagyok",
        shot: "Feles",
        beautiful: "Gy√∂ny√∂r≈±",
        love: "Szerelmem",
        iloveyou: "Szeretlek",
        lang: "hu-HU" 
    },
    "Wien": { 
        hello: "Servus", 
        cheers: "Prost", 
        beer: "Kr√ºgerl", 
        thanks: "Danke", 
        bill: "Zahlen bitte",
        ass: "Oasch",
        fuck: "Schei√üe",
        drunk: "I bin betrunken",
        cool: "Leiwand",
        sexy: "Sexy",
        hungry: "I hab Hunger",
        thirsty: "I hab Durst",
        shot: "Stamperl",
        beautiful: "Wundersch√∂n",
        love: "Mein Schatz",
        iloveyou: "I liab di",
        lang: "de-AT" 
    },
    "Prag": { 
        hello: "Ahoj", 
        cheers: "Na zdrav√≠", 
        beer: "Pivo", 
        thanks: "Dƒõkuji", 
        bill: "√öƒçet pros√≠m",
        ass: "Prdel",
        fuck: "Do prdele",
        drunk: "Jsem opil√Ω",
        cool: "Super",
        sexy: "Sexy",
        hungry: "M√°m hlad",
        thirsty: "M√°m ≈æ√≠ze≈à",
        shot: "Pan√°k",
        beautiful: "Kr√°sn√°",
        love: "M≈Øj mil√°ƒçek",
        iloveyou: "Miluji tƒõ",
        lang: "cs-CZ" 
    },
    "Transfer": { 
        hello: "Choo Choo", 
        cheers: "Prost", 
        beer: "Bier", 
        thanks: "Danke", 
        bill: "Ticket", 
        lang: "en-US" 
    }
};

        const CHALLENGES = [
            "üì∏ Macht ein Foto, auf dem einer von euch wie ein Tourist-Klischee posiert.",
            "üé¨ Findet einen Aussichtspunkt und macht ein ‚Äûdramatisches Filmplakat‚Äú-Foto.",
            "üò≤ Macht ein Foto, als w√ºrdet ihr euch gerade zum ersten Mal sehen.",
            "üçπ Bestellt Getr√§nke f√ºreinander ‚Äì ohne Absprache.",
            "üè∑Ô∏è Gebt euch gegenseitig einen neuen Spitznamen f√ºr den restlichen Tag.",
            "ü§™ Versucht, jemanden dazu zu bringen, ein Foto von euch zu machen ‚Äì aber in einer absurden Pose.",
            "üç∏ Bestellt den Drink mit dem weirdesten Namen auf der Karte.",
            "üóø Finde eine Skulptur und mache ein sexy Foto damit.",
            "üçª Ex dein Bier! (Oder sag an, sobald du es machst, damit die andere Person es wei√ü).",
            "üì∏ Mach ein sexy Foto von deinem Partner beim Essen."
        ];

        // --- DATENBANK ---
        const DB = [
            { id: "h1", lat: 47.4965, lng: 19.0629, city: "Budapest", cat: "Hotel", subtag: "hotel", title: "Quiet Retreat", cost: "???", time: "Check-in 15:00", res: "Gebucht", address: "Kazinczy utca 11, 1075 Budapest", desc: "Direkt neben Szimpla Kert. Mitten im Geschehen, aber ruhig.", img: "hotelbuda.jpg" },
            { id: "h2", lat: 48.1936, lng: 16.3547, city: "Wien", cat: "Hotel", subtag: "hotel", title: "Hotel Indigo Naschmarkt", cost: "???", time: "Check-in 15:00", res: "Gebucht", address: "Rechte Wienzeile 87, 1050 Wien", desc: "Design Hotel direkt am Naschmarkt. Hidden Garden.", img: "hotelwien.jpg" },
            { id: "t1", lat: 47.5004, lng: 19.0840, city: "Transfer", cat: "Transport", subtag: "train", title: "RegioJet Business Class", cost: 40, time: "2h 40min", res: "Zwingend", address: "Budapest-Keleti, 1087 Budapest", desc: "Route: Budapest -> Wien. 4er-Abteil, Ledersessel. Gratis Sekt/Kaffee.", img: "regiojetbu.jpg" },
            { id: "t2", lat: 48.1850, lng: 16.3779, city: "Transfer", cat: "Transport", subtag: "train", title: "√ñBB Railjet Business", cost: 80, time: "4h 05min", res: "Zwingend", address: "Wien Hbf, 1100 Wien", desc: "Route: Wien -> Prag. Upgrade zur 1. Klasse. Extrem ruhig.", img: "regiojetbu.jpg" },
            { id: "b_f1", lat: 47.5040, lng: 19.0628, city: "Budapest", cat: "Essen", subtag: "casual", title: "Menza √âtterem", cost: 35, time: "1.5h", res: "Empfohlen", address: "Liszt Ferenc t√©r 2, 1061 Ungarn", desc: "Retro-70er Style Kantine, gehoben. Sehr lecker.", img: "menzatt.jpg" },
            { id: "b_f2", lat: 47.4975, lng: 19.0635, city: "Budapest", cat: "Essen", subtag: "street", title: "Street Food Karavan", cost: 15, time: "45min", res: "Nein", address: "Kazinczy u. 18, 1075 Ungarn", desc: "Direkt neben Szimpla. L√°ngos-Burger.", img: "streetfo.jpg" },
            { id: "b_f3", lat: 47.5004, lng: 19.0657, city: "Budapest", cat: "Essen", subtag: "fine", title: "Mazel Tov", cost: 60, time: "2h", res: "Zwingend", address: "Ak√°cfa u. 47, 1072 Ungarn", desc: "Israelische Fusion in schicker Ruine. Tolle Atmosph√§re.", img: "mazelto.jpg" },
            { id: "b_f4", lat: 47.4873, lng: 19.0611, city: "Budapest", cat: "Essen", subtag: "street", title: "Pizza Manufaktura", cost: 20, time: "1h", res: "Nein", address: "L√≥nyay u. 9, 1093 Ungarn", desc: "Local & Pizza. Entspannt, g√ºnstig.", img: "pizzama.jpg" },
            { id: "b_f5", lat: 47.4998, lng: 19.0585, city: "Budapest", cat: "Essen", subtag: "fine", title: "Twentysix", cost: 70, time: "2h", res: "Empfohlen", address: "Kir√°ly u. 26, 1061 Ungarn", desc: "Indoor-Dschungel. Mediterran.", img: "twentysix.jpg" },
            { id: "b_f6", lat: 47.4975, lng: 19.0627, city: "Budapest", cat: "Essen", subtag: "casual", title: "Gett√≥ Guly√°s", cost: 30, time: "1.5h", res: "Empfohlen", address: "Wessel√©nyi u. 18, 1077 Ungarn", desc: "Bestes P√∂rk√∂lt (Gulasch) im Partyviertel.", img: "gettgu.jpg" },
            { id: "b_f7", lat: 47.4984, lng: 19.0615, city: "Budapest", cat: "Essen", subtag: "cafe", title: "Cirkusz", cost: 30, time: "1.5h", res: "Nein", address: "Dob u. 25, 1074 Ungarn", desc: "Ber√ºhmtester Brunch-Spot.", img: "cirkusz.jpg" },
            { id: "b_f8", lat: 47.5001, lng: 19.0510, city: "Budapest", cat: "Essen", subtag: "street", title: "Bamba Marha", cost: 20, time: "45min", res: "Nein", address: "Okt√≥ber 6. u. 6, 1051 Ungarn", desc: "Top Burger.", img: "bambama.jpg" },
            { id: "b_f9", lat: 47.5025, lng: 19.0640, city: "Budapest", cat: "Essen", subtag: "street", title: "Frici Papa", cost: 15, time: "45min", res: "Nein", address: "Kir√°ly u. 55, 1077 Ungarn", desc: "Kantine. Spottbillig.", img: "fricipa.jpg" },
            { id: "b_f10", lat: 47.4968, lng: 19.0598, city: "Budapest", cat: "Essen", subtag: "casual", title: "Dobrumba", cost: 40, time: "1.5h", res: "Empfohlen", address: "Dob u. 5, 1074 Ungarn", desc: "Levante K√ºche. Sehr hip.", img: "dobrumba.jpg" },
            { id: "b_f11", lat: 47.4922, lng: 19.0571, city: "Budapest", cat: "Essen", subtag: "fine", title: "Beerstro 14", cost: 50, time: "1.5h", res: "Empfohlen", address: "K√°rolyi utca 12, 1053 Ungarn", desc: "Steaks und Craft Beer.", img: "beerstro14.jpg" },
            { id: "b_f12", lat: 47.5011, lng: 19.0327, city: "Budapest", cat: "Essen", subtag: "casual", title: "Jamie Oliver's Italian", cost: 50, time: "1.5h", res: "M√∂glich", address: "Szenth√°roms√°g u. 9-11, 1014 Ungarn", desc: "Solide Lage bei Fischerbastei.", img: "jamieol.jpg" },
            { id: "b_f13", lat: 47.4975, lng: 19.0314, city: "Budapest", cat: "Essen", subtag: "fine", title: "D√©ryn√©", cost: 60, time: "2h", res: "Zwingend", address: "Krisztina t√©r 3, 1013 Ungarn", desc: "Treffpunkt der Buda-Elite.", img: "dryn.jpg" },
            { id: "b_f14", lat: 47.4787, lng: 19.0501, city: "Budapest", cat: "Essen", subtag: "street", title: "Moto Pizza", cost: 25, time: "1h", res: "Nein", address: "Bart√≥k B√©la √∫t 46, 1111 Ungarn", desc: "Neapolitanische Pizza.", img: "motopi.jpg" },
            { id: "b_f15", lat: 47.4967, lng: 19.0635, city: "Budapest", cat: "Essen", subtag: "street", title: "Bors Gastro Bar", cost: 15, time: "30min", res: "Nein", address: "Kazinczy u. 10, 1075 Ungarn", desc: "Suppen/Baguettes to go.", img: "borsga.jpg" },
            { id: "b_f16", lat: 47.5055, lng: 19.0372, city: "Budapest", cat: "Essen", subtag: "cafe", title: "Franziska", cost: 35, time: "1.5h", res: "Empfohlen", address: "Iskola u. 29, 1011 Ungarn", desc: "Healthy Food, Smoothie Bowls.", img: "franziska.jpg" },
            { id: "b_f17", lat: 47.4980, lng: 19.0647, city: "Budapest", cat: "Essen", subtag: "casual", title: "Vinyl & Wood", cost: 25, time: "1h", res: "Nein", address: "Wessel√©nyi u. 23, 1077 Ungarn", desc: "Cooles Design, guter Toast.", img: "vinylwo.jpg" },
            { id: "b_f18", lat: 47.4871, lng: 19.0584, city: "Budapest", cat: "Essen", subtag: "street", title: "Gro√üe Markthalle", cost: 15, time: "1h", res: "Nein", address: "V√°mh√°z krt. 1-3, 1093 Ungarn", desc: "St√§nde (Langos/Wurst).", img: "groema.jpg" },
            { id: "b_f19", lat: 47.5022, lng: 19.0529, city: "Budapest", cat: "Essen", subtag: "cafe", title: "Pink Pistachio", cost: 20, time: "30min", res: "Nein", address: "Hercegpr√≠m√°s u. 15, 1051 Ungarn", desc: "S√º√ües & Eis.", img: "pinkpi.jpg" },
            { id: "b_f20", lat: 47.5031, lng: 19.0552, city: "Budapest", cat: "Essen", subtag: "street", title: "Retro L√°ngos", cost: 10, time: "30min", res: "Nein", address: "Bajcsy-Zsilinszky √∫t 25, 1065 Ungarn", desc: "Der Klassiker f√ºr L√°ngos.", img: "retroln.jpg" },
            { id: "b_f21", lat: 47.5022, lng: 19.0529, city: "Budapest", cat: "Essen", subtag: "cafe", title: "Cookie Beacon", cost: 20, time: "45min", res: "Nein", address: "Hercegpr√≠m√°s u. 15, 1051 Ungarn", desc: "Massive Cookies & Brunch.", img: "cookiebe.jpg" },
            { id: "b_f22", lat: 47.4960, lng: 19.0531, city: "Budapest", cat: "Essen", subtag: "street", title: "Buddy's Smash Burgers", cost: 20, time: "45min", res: "Nein", address: "Feh√©r Haj√≥ u. 8, 1052 Ungarn", desc: "Smashed Burger.", img: "buddys.jpg" },
            { id: "b_f23", lat: 47.4996, lng: 19.0501, city: "Budapest", cat: "Essen", subtag: "casual", title: "Retek Bistro", cost: 40, time: "1.5h", res: "Empfohlen", address: "M√©rleg u. 10, 1051 Ungarn", desc: "Klassisch ungarisch.", img: "retekbi.jpg" },
            { id: "b_f24", lat: 47.4902, lng: 19.0646, city: "Budapest", cat: "Essen", subtag: "fine", title: "Arquitecto Pitpit", cost: 50, time: "2h", res: "Empfohlen", address: "√ñtpacsirta u. 2, 1088 Ungarn", desc: "Tapas im Innenhof.", img: "arquitectopi.jpg" },
            { id: "b_f25", lat: 47.4960, lng: 19.0527, city: "Budapest", cat: "Essen", subtag: "street", title: "Crudo Pizza", cost: 25, time: "1h", res: "Nein", address: "Feh√©r Haj√≥ u. 2-6, 1052 Ungarn", desc: "Pizza & Wine.", img: "crudopi.jpg" },
            { id: "b_f26", lat: 47.4994, lng: 19.0606, city: "Budapest", cat: "Essen", subtag: "cafe", title: "Fluffy and me Pancake", cost: 20, time: "45min", res: "Nein", address: "Kazinczy u. 52 C, 1075 Ungarn", desc: "Fluffige japanische Pancakes.", img: "fluffyan.jpg" },
            { id: "b_f27", lat: 47.5115, lng: 19.0573, city: "Budapest", cat: "Essen", subtag: "street", title: "McDonalds Nyugati", cost: 15, time: "30min", res: "Nein", address: "Ter√©z krt. 55, 1062 Ungarn", desc: "Der sch√∂nste McDonalds der Welt.", img: "mcdonaldsny.jpg" },
            { id: "b_f28", lat: 47.5097, lng: 19.0578, city: "Budapest", cat: "Essen", subtag: "casual", title: "Sir Lancelot Knights' Restaurant", cost: 35, time: "120min", res: "Ja", address: "Podmaniczky u. 14, 1065 Ungarn", desc: "Mittelalterliches Spektakel mit Deftigem vom Schwert, Feuershows und rustikalem Ambiente.", img: "sirlancelot.jpg" },
            { id: "b_a1", lat: 47.5069, lng: 19.0650, city: "Budapest", cat: "Aktivit√§t", subtag: "culture", title: "House of Terror", cost: 15, time: "2h", res: "Nein", address: "Andr√°ssy √∫t 60, 1062 Ungarn", desc: "Museum Nazi- & Sowjetzeit.", img: "houseof.jpg" },
            { id: "b_a2", lat: 47.5203, lng: 19.0551, city: "Budapest", cat: "Aktivit√§t", subtag: "relax", title: "Mandala Day Spa", cost: 100, time: "3h+", res: "Zwingend", address: "Ipoly u. 8, 1133 Ungarn", desc: "Luxus pur, Massagen.", img: "mandalada.jpg" },
            { id: "b_a3", lat: 47.4989, lng: 19.0788, city: "Budapest", cat: "Aktivit√§t", subtag: "culture", title: "Chimney Cake Workshop", cost: 35, time: "1.5h", res: "Zwingend", address: "R√°k√≥czi √∫t 73, 1088 Ungarn", desc: "K√ºrt≈ëskal√°cs selber backen.", img: "chimneyca.jpg" },
            { id: "b_a4", lat: 47.5146, lng: 19.0544, city: "Budapest", cat: "Aktivit√§t", subtag: "relax", title: "Flippermuseum", cost: 15, time: "2h+", res: "Nein", address: "Radn√≥ti Mikl√≥s u. 18, 1137 Ungarn", desc: "140+ Automaten Free Play.", img: "flippermuseum.jpg" },
            { id: "b_a5", lat: 47.5008, lng: 19.0540, city: "Budapest", cat: "Aktivit√§t", subtag: "relax", title: "St. Stephans Basilika", cost: 10, time: "1h", res: "Nein", address: "Szent Istv√°n t√©r 1, 1051 Ungarn", desc: "Hoch auf die Kuppel f√ºr den Ausblick.", img: "stst.jpg" },
            { id: "b_a6", lat: 47.4962, lng: 19.0398, city: "Budapest", cat: "Aktivit√§t", subtag: "relax", title: "Budaer Burgviertel", cost: 15, time: "2h", res: "Nein", address: "Szent Gy√∂rgy t√©r 2, 1014 Ungarn", desc: "Mit Standseilbahn hoch. Aussicht genie√üen.", img: "budaerbu.jpg" },
            { id: "b_a7", lat: 47.5042, lng: 19.0448, city: "Budapest", cat: "Aktivit√§t", subtag: "relax", title: "Schuhe am Donauufer", cost: 0, time: "30min", res: "Nein", address: "Id. Antall J√≥zsef rkp., 1054 Ungarn", desc: "Bewegendes Mahnmal.", img: "schuheam.jpg" },
            { id: "b_a8", lat: 47.5048, lng: 19.0528, city: "Budapest", cat: "Aktivit√§t", subtag: "culture", title: "Light Art Museum", cost: 25, time: "1.5h", res: "Empfohlen", address: "Hold u. 13, 1054 Ungarn", desc: "Trippy Lichtinstallationen.", img: "lightar.jpg" },
            { id: "b_a9", lat: 47.4992, lng: 19.0350, city: "Budapest", cat: "Aktivit√§t", subtag: "culture", title: "House of Houdini", cost: 15, time: "1h", res: "Nein", address: "D√≠sz t√©r 11, 1014 Ungarn", desc: "Im Burgviertel. Mit Live-Zaubershow.", img: "houseofhou.jpg" },
            { id: "b_a10", lat: 47.5023, lng: 19.0344, city: "Budapest", cat: "Aktivit√§t", subtag: "culture", title: "Fischerbastei", cost: 10, time: "1h", res: "Nein", address: "Szenth√°roms√°g t√©r, 1014 Ungarn", desc: "Der Fotospot schlechthin.", img: "fischerbastei.jpg" },
            { id: "b_a11", lat: 47.5008, lng: 19.0314, city: "Budapest", cat: "Aktivit√§t", subtag: "culture", title: "Hospital in the Rock", cost: 20, time: "1.5h", res: "Empfohlen", address: "Lovas √∫t 4/c, 1012 Ungarn", desc: "Atombunker/Hospital.", img: "hospitalin.jpg" },
            { id: "b_a12", lat: 47.5165, lng: 18.9747, city: "Budapest", cat: "Aktivit√§t", subtag: "relax", title: "Zugliget Chairlift", cost: 15, time: "1h", res: "Nein", address: "Zugligeti √∫t 97, 1121 Ungarn", desc: "Sessellift.", img: "zugligetch.jpg" },
            { id: "b_a13", lat: 47.5022, lng: 19.0603, city: "Budapest", cat: "Aktivit√§t", subtag: "culture", title: "Museum of Sweets & Selfies", cost: 20, time: "1h", res: "Empfohlen", address: "Paulay Ede u. 43, 1061 Ungarn", desc: "Instagram Fotos.", img: "museumof.jpg" },
            { id: "b_a14", lat: 47.4597, lng: 19.0515, city: "Budapest", cat: "Aktivit√§t", subtag: "relax", title: "Cyberjump", cost: 20, time: "1.5h", res: "Empfohlen", address: "Hengermalom √∫t 19, 1117 Ungarn", desc: "Trampolin Park.", img: "cyberjump.jpg" },
            { id: "b_a15", lat: 47.4980, lng: 19.0516, city: "Budapest", cat: "Aktivit√§t", subtag: "relax", title: "Budapest Eye", cost: 15, time: "20min", res: "Nein", address: "Erzs√©bet t√©r, 1051 Ungarn", desc: "Riesenrad.", img: "budapestey.jpg" },
            { id: "b_a16", lat: 47.4982, lng: 19.0598, city: "Budapest", cat: "Aktivit√§t", subtag: "relax", title: "Gozsdu Udvar Arcade", cost: 10, time: "30min", res: "Nein", address: "Dob u. 16, 1075 Ungarn", desc: "Airhockey.", img: "gozsduud.jpg" },
            { id: "b_a17", lat: 47.5060, lng: 19.0390, city: "Budapest", cat: "Aktivit√§t", subtag: "relax", title: "Donau Night Walk", cost: 0, time: "1h", res: "Nein", address: "Bem rkp., 1011 Ungarn", desc: "Parlament leuchtet.", img: "donauni.jpg" },
            { id: "b_a18", lat: 47.4891, lng: 19.0478, city: "Budapest", cat: "Aktivit√§t", subtag: "relax", title: "Rudas Bad", cost: 35, time: "3h", res: "Nein", address: "D√∂brentei t√©r 9, 1013 Ungarn", desc: "T√ºrkisches Bad.", img: "rudasba.jpg" },
            { id: "b_a19", lat: 47.5180, lng: 19.0371, city: "Budapest", cat: "Aktivit√§t", subtag: "relax", title: "Luk√°cs Bad", cost: 25, time: "3h", res: "Nein", address: "Frankel Le√≥ √∫t 25-29, 1023 Ungarn", desc: "Favorit der Einheimischen.", img: "lukcsba.jpg" },
            { id: "b_a20", lat: 47.5273, lng: 19.0479, city: "Budapest", cat: "Aktivit√§t", subtag: "relax", title: "Palatinus Strand", cost: 20, time: "4h", res: "Nein", address: "Margitsziget, 1007 Ungarn", desc: "Freibad Margareteninsel.", img: "palatinusst.jpg" },
            { id: "b_p1", lat: 47.4969, lng: 19.0633, city: "Budapest", cat: "Party", subtag: "bar", title: "Szimpla Kert", cost: 15, time: "Open End", res: "Nein", address: "Kazinczy u. 14, 1075 Ungarn", desc: "Muss sein. Ruinenbar.", img: "szimplake.jpg" },
            { id: "b_p2", lat: 47.5005, lng: 19.0655, city: "Budapest", cat: "Party", subtag: "club", title: "Instant-Fogas", cost: 10, time: "Bis 06:00", res: "Nein", address: "Ak√°cfa u. 49-51, 1073 Ungarn", desc: "Riesiges Labyrinth, 7 Floors.", img: "instantfogas.jpg" },
            { id: "b_p3", lat: 47.4976, lng: 19.0610, city: "Budapest", cat: "Party", subtag: "bar", title: "Hotsy Totsy", cost: 40, time: "2h", res: "Empfohlen", address: "S√≠p u. 24, 1075 Ungarn", desc: "High-End Cocktails.", img: "hotsyto.jpg" },
            { id: "b_p4", lat: 47.4979, lng: 19.0596, city: "Budapest", cat: "Party", subtag: "club", title: "Aether", cost: 20, time: "Bis 06:00", res: "Nein", address: "Kiraly u. 13 (Gozsdu), 1075 Ungarn", desc: "Techno/House Keller.", img: "aether.jpg" },
            { id: "b_p5", lat: 47.5005, lng: 19.0507, city: "Budapest", cat: "Party", subtag: "club", title: "√ñtkert", cost: 20, time: "Bis 05:00", res: "Nein", address: "Zr√≠nyi u. 4/A, 1051 Ungarn", desc: "Posher, R&B Hits.", img: "tkert.jpg" },
            { id: "b_p6", lat: 47.4991, lng: 19.0461, city: "Budapest", cat: "Party", subtag: "bar", title: "Pontoon", cost: 0, time: "Open End", res: "Nein", address: "Id. Antall J√≥zsef rkp. 1, 1051 Ungarn", desc: "Open Air an der Br√ºcke.", img: "pontoon.jpg" },
            { id: "b_p7", lat: 47.4600, lng: 19.0575, city: "Budapest", cat: "Party", subtag: "bar", title: "D√ºrer Kert", cost: 15, time: "Open End", res: "Nein", address: "√ñb√∂l u. 1, 1117 Ungarn", desc: "Alternative Szene, Garten.", img: "drerke.jpg" },
            { id: "b_p8", lat: 47.4928, lng: 19.0496, city: "Budapest", cat: "Party", subtag: "club", title: "Budapest Boat Party", cost: 40, time: "22:00-00:00", res: "Ticket", address: "Pet≈ëfi t√©r 9, 1052 Ungarn", desc: "Auf Schiff saufen.", img: "budapestbo.jpg" },
            { id: "b_p9", lat: 47.4993, lng: 19.0563, city: "Budapest", cat: "Party", subtag: "bar", title: "Boutiq'Bar", cost: 40, time: "2h", res: "Empfohlen", address: "Paulay Ede u. 5, 1061 Ungarn", desc: "Weltklasse Cocktails.", img: "boutiqbar.jpg" },
            { id: "b_p10", lat: 47.4928, lng: 19.0602, city: "Budapest", cat: "Party", subtag: "bar", title: "Csendes L√©tterem", cost: 15, time: "2h", res: "Nein", address: "Ferenczy Istv√°n u. 5, 1053 Ungarn", desc: "Surreale Vintage-Bar.", img: "csendeslt.jpg" },
            { id: "b_p11", lat: 47.4836, lng: 19.0727, city: "Budapest", cat: "Party", subtag: "bar", title: "√âleszt≈ëh√°z", cost: 20, time: "2h", res: "Nein", address: "T≈±zolt√≥ u. 22, 1094 Ungarn", desc: "Ruinen-Pub f√ºr Craft Beer.", img: "leszthz.jpg" },
            { id: "b_p12", lat: 47.4981, lng: 19.0555, city: "Budapest", cat: "Party", subtag: "bar", title: "Madhouse", cost: 25, time: "2h", res: "Nein", address: "Anker k√∂z 1-3, 1061 Ungarn", desc: "Bistro der Mad Scientist Brauerei.", img: "madhouse.jpg" },
            { id: "w_f1", lat: 48.2100, lng: 16.3683, city: "Wien", cat: "Essen", subtag: "casual", title: "Schwarzes Kameel", cost: 35, time: "1h", res: "Nein", address: "Bognergasse 5, 1010 Wien", desc: "MUST-DO. Stehbuffet, Br√∂tchen & Wein. Society Treff.", img: "schwarzeska.jpg" },
            { id: "w_f2", lat: 48.2094, lng: 16.3748, city: "Wien", cat: "Essen", subtag: "casual", title: "Figlm√ºller", cost: 45, time: "1.5h", res: "Zwingend", address: "Wollzeile 5, 1010 Wien", desc: "Heimat des Schnitzels.", img: "figlmller.jpg" },
            { id: "w_f3", lat: 48.1979, lng: 16.3621, city: "Wien", cat: "Essen", subtag: "casual", title: "Naschmarkt (NENI)", cost: 35, time: "1.5h", res: "Empfohlen", address: "Naschmarkt 510, 1060 Wien", desc: "Israelisch am Markt.", img: "naschmarkt.jpg" },
            { id: "w_f4", lat: 48.2135, lng: 16.3816, city: "Wien", cat: "Essen", subtag: "fine", title: "Mochi", cost: 80, time: "2h", res: "Zwingend", address: "Praterstra√üe 15, 1020 Wien", desc: "Bestes Sushi/Fusion.", img: "mochi.jpg" },
            { id: "w_f5", lat: 48.2048, lng: 16.3436, city: "Wien", cat: "Essen", subtag: "fine", title: "Seven North", cost: 70, time: "2.5h", res: "Empfohlen", address: "Schottenfeldgasse 74, 1070 Wien", desc: "Eyal Shani. Laut, international.", img: "sevenno.jpg" },
            { id: "w_f6", lat: 48.2025, lng: 16.3492, city: "Wien", cat: "Essen", subtag: "casual", title: "Schnitzelwirt", cost: 30, time: "1h", res: "Nein", address: "Neubaugasse 52, 1070 Wien", desc: "Riesige Portionen, g√ºnstig.", img: "schnitzelwirt.jpg" },
            { id: "w_f7", lat: 48.1987, lng: 16.3663, city: "Wien", cat: "Essen", subtag: "street", title: "Swing Kitchen", cost: 20, time: "45min", res: "Nein", address: "Operngasse 24, 1040 Wien", desc: "Bester veganer Burger.", img: "swingki.jpg" },
            { id: "w_f8", lat: 48.2022, lng: 16.3676, city: "Wien", cat: "Essen", subtag: "street", title: "Leberkas-Pepi", cost: 8, time: "15min", res: "Nein", address: "Operngasse 12, 1010 Wien", desc: "Bester Leberk√§se.", img: "leberkaspepi.jpg" },
            { id: "w_f9", lat: 48.2030, lng: 16.3549, city: "Wien", cat: "Essen", subtag: "fine", title: "Tian Bistro", cost: 60, time: "2h", res: "Empfohlen", address: "Schrankgasse 4, 1070 Wien", desc: "Vegetarisches Fine Dining.", img: "tianbi.jpg" },
            { id: "w_f10", lat: 48.2097, lng: 16.3751, city: "Wien", cat: "Essen", subtag: "fine", title: "Lugeck", cost: 50, time: "2h", res: "Zwingend", address: "Lugeck 4, 1010 Wien", desc: "Modernes Wirtshaus.", img: "lugeck.jpg" },
            { id: "w_f11", lat: 48.1984, lng: 16.3624, city: "Wien", cat: "Essen", subtag: "cafe", title: "Caf√© Drechsler", cost: 25, time: "1h", res: "Nein", address: "Linke Wienzeile 22, 1060 Wien", desc: "Klassisches Kaffeehaus.", img: "cafdr.jpg" },
            { id: "w_f12", lat: 48.1977, lng: 16.3650, city: "Wien", cat: "Essen", subtag: "cafe", title: "Vollpension", cost: 25, time: "1.5h", res: "Empfohlen", address: "Schleifm√ºhlgasse 16, 1040 Wien", desc: "Kuchen von Omas.", img: "vollpension.jpg" },
            { id: "w_f13", lat: 48.2028, lng: 16.3533, city: "Wien", cat: "Essen", subtag: "cafe", title: "Ulrich", cost: 35, time: "1.5h", res: "Empfohlen", address: "Sankt-Ulrichs-Platz 1, 1070 Wien", desc: "Top Fr√ºhst√ºck.", img: "ulrich.jpg" },
            { id: "w_f14", lat: 48.2129, lng: 16.3800, city: "Wien", cat: "Essen", subtag: "fine", title: "Das Loft", cost: 60, time: "2h", res: "Zwingend", address: "Praterstra√üe 1, 1020 Wien", desc: "Teurer Brunch mit Blick.", img: "daslo.jpg" },
            { id: "w_f15", lat: 48.2139, lng: 16.4016, city: "Wien", cat: "Essen", subtag: "casual", title: "Schweizerhaus", cost: 40, time: "2h", res: "Nein", address: "Prater 116, 1020 Wien", desc: "Stelze und Bier.", img: "schweizerhaus.jpg" },
            { id: "w_f16", lat: 48.2032, lng: 16.3571, city: "Wien", cat: "Essen", subtag: "casual", title: "Glacis Beisl", cost: 45, time: "2h", res: "Empfohlen", address: "Breite G. 4, 1070 Wien", desc: "Versteckt im MQ.", img: "glacisbe.jpg" },
            { id: "w_f17", lat: 48.2193, lng: 16.3770, city: "Wien", cat: "Essen", subtag: "street", title: "Pizza Mari", cost: 25, time: "1h", res: "Nein", address: "Leopoldsgasse 23A, 1020 Wien", desc: "Beste Pizza.", img: "pizzamari.jpg" },
            { id: "w_f18", lat: 48.2109, lng: 16.3771, city: "Wien", cat: "Essen", subtag: "street", title: "Fenster Caf√©", cost: 10, time: "15min", res: "Nein", address: "Griechengasse 10, 1010 Wien", desc: "Kaffee in der Waffel.", img: "fensterca.jpg" },
            { id: "w_f19", lat: 48.2107, lng: 16.3651, city: "Wien", cat: "Essen", subtag: "cafe", title: "Caf√© Central", cost: 30, time: "1h", res: "Nein", address: "Herrengasse 14, 1010 Wien", desc: "Touristisch, aber sch√∂n.", img: "cafce.jpg" },
            { id: "w_f20", lat: 48.2171, lng: 16.3627, city: "Wien", cat: "Essen", subtag: "street", title: "Der Wiener Deewan", cost: 15, time: "45min", res: "Nein", address: "Liechtensteinstra√üe 10, 1090 Wien", desc: "Pay as you wish.", img: "derwi.jpg" },
            { id: "w_f21", lat: 48.2046, lng: 16.3683, city: "Wien", cat: "Essen", subtag: "street", title: "Bitzinger", cost: 10, time: "15min", res: "Nein", address: "Albertinaplatz 1, 1010 Wien", desc: "Bester W√ºrstelstand.", img: "bitzinger.jpg" },
            { id: "w_f22", lat: 48.2026, lng: 16.3591, city: "Wien", cat: "Essen", subtag: "street", title: "Burger Bros", cost: 20, time: "45min", res: "Nein", address: "Museumsplatz 1, 1070 Wien", desc: "Casual Burger.", img: "burgerbr.jpg" },
            { id: "w_f23", lat: 48.1968, lng: 16.3453, city: "Wien", cat: "Essen", subtag: "street", title: "Ivy's Pho", cost: 20, time: "45min", res: "Nein", address: "Mariahilfer Str. 103, 1060 Wien", desc: "Vietnamesisch.", img: "ivysph.jpg" },
            { id: "w_f24", lat: 48.2058, lng: 16.3561, city: "Wien", cat: "Essen", subtag: "casual", title: "1500 Foodmakers", cost: 40, time: "1.5h", res: "Empfohlen", address: "Museumstra√üe 9, 1070 Wien", desc: "Im 25hours Hotel.", img: "1500fo.jpg" },
            { id: "w_f25", lat: 48.2121, lng: 16.3778, city: "Wien", cat: "Essen", subtag: "fine", title: "Motto am Fluss", cost: 50, time: "2h", res: "Empfohlen", address: "Franz-Josefs-Kai 2, 1010 Wien", desc: "Schiff-Design.", img: "mottoam.jpg" },
            { id: "w_f26", lat: 48.2002, lng: 16.3617, city: "Wien", cat: "Essen", subtag: "casual", title: "Ramien", cost: 30, time: "1h", res: "Nein", address: "Gumpendorfer Str. 9, 1060 Wien", desc: "Asiatisch.", img: "ramien.jpg" },
            { id: "w_a1", lat: 48.2046, lng: 16.3683, city: "Wien", cat: "Aktivit√§t", subtag: "culture", title: "Albertina", cost: 20, time: "2h", res: "Nein", address: "Albertinaplatz 1, 1010 Wien", desc: "Prunkr√§ume & Kunst.", img: "albertina.jpg" },
            { id: "w_a2", lat: 48.2075, lng: 16.3940, city: "Wien", cat: "Aktivit√§t", subtag: "culture", title: "Hundertwasserhaus", cost: 0, time: "30min", res: "Nein", address: "Kegelgasse 36-38, 1030 Wien", desc: "Architektur Fotos.", img: "hundertwasserhaus.jpg" },
            { id: "w_a3", lat: 48.2036, lng: 16.4233, city: "Wien", cat: "Aktivit√§t", subtag: "relax", title: "Prater", cost: 30, time: "3h", res: "Nein", address: "1020 Wien", desc: "Vergn√ºgungspark.", img: "prater.jpg" },
            { id: "w_a4", lat: 48.2160, lng: 16.3513, city: "Wien", cat: "Aktivit√§t", subtag: "culture", title: "Narrenturm", cost: 15, time: "1h", res: "Nein", address: "Spitalgasse 2, 1090 Wien", desc: "Pathologisch-anatomisch.", img: "narrenturm.jpg" },
            { id: "w_a5", lat: 48.2045, lng: 16.3620, city: "Wien", cat: "Aktivit√§t", subtag: "culture", title: "KHM", cost: 20, time: "2h", res: "Nein", address: "Maria-Theresien-Platz, 1010 Wien", desc: "Kunsthistorisches Museum.", img: "khm.jpg" },
            { id: "w_a6", lat: 48.1850, lng: 16.3116, city: "Wien", cat: "Aktivit√§t", subtag: "culture", title: "Schloss Sch√∂nbrunn", cost: 0, time: "2h", res: "Nein", address: "Sch√∂nbrunner Schlo√üstra√üe 47, 1130 Wien", desc: "Park ist gratis.", img: "schlosssc.jpg" },
            { id: "w_a7", lat: 48.1976, lng: 16.3530, city: "Wien", cat: "Aktivit√§t", subtag: "relax", title: "Haus des Meeres", cost: 25, time: "2h", res: "Nein", address: "Fritz-Gr√ºnbaum-Platz 1, 1060 Wien", desc: "Aquarium im Flakturm.", img: "hausde.jpg" },
            { id: "w_a8", lat: 48.1434, lng: 16.4006, city: "Wien", cat: "Aktivit√§t", subtag: "relax", title: "Therme Wien", cost: 40, time: "4h", res: "Nein", address: "Kurbadstra√üe 14, 1100 Wien", desc: "Moderne Therme.", img: "thermewi.jpg" },
            { id: "w_a9", lat: 48.1742, lng: 16.3791, city: "Wien", cat: "Aktivit√§t", subtag: "relax", title: "Amalienbad", cost: 10, time: "2h", res: "Nein", address: "Reumannplatz 23, 1100 Wien", desc: "Historisches Hallenbad.", img: "amalienbad.jpg" },
            { id: "w_a10", lat: 48.2128, lng: 16.3924, city: "Wien", cat: "Aktivit√§t", subtag: "relax", title: "Donaukanal", cost: 0, time: "1h", res: "Nein", address: "Donaukanal, 1010 Wien", desc: "Graffiti & Chillen.", img: "donaukanal.jpg" },
            { id: "w_a11", lat: 48.1912, lng: 16.3798, city: "Wien", cat: "Aktivit√§t", subtag: "culture", title: "Belvedere", cost: 20, time: "1.5h", res: "Empfohlen", address: "Prinz Eugen-Stra√üe 27, 1030 Wien", desc: "Klimt's Kuss.", img: "belvedere.jpg" },
            { id: "w_a12", lat: 48.2038, lng: 16.3657, city: "Wien", cat: "Aktivit√§t", subtag: "relax", title: "Schmetterlinghaus", cost: 10, time: "30min", res: "Nein", address: "Hofburg, 1010 Wien", desc: "Im Burggarten.", img: "schmetterlinghaus.jpg" },
            { id: "w_a13", lat: 48.2057, lng: 16.3627, city: "Wien", cat: "Aktivit√§t", subtag: "culture", title: "Weltmuseum", cost: 15, time: "1.5h", res: "Nein", address: "Heldenplatz, 1010 Wien", desc: "Ethnologie.", img: "weltmuseum.jpg" },
            { id: "w_a14", lat: 48.2038, lng: 16.3731, city: "Wien", cat: "Aktivit√§t", subtag: "culture", title: "Haus der Musik", cost: 15, time: "1.5h", res: "Nein", address: "Seilerst√§tte 30, 1010 Wien", desc: "Interaktiv.", img: "hausdermusik.jpg" },
            { id: "w_a15", lat: 48.2016, lng: 16.3691, city: "Wien", cat: "Aktivit√§t", subtag: "culture", title: "Dritte Mann Tour", cost: 25, time: "1h", res: "Ticket", address: "Karlsplatz, 1010 Wien", desc: "Kanaltour.", img: "drittema.jpg" },
            { id: "w_a16", lat: 48.2082, lng: 16.3682, city: "Wien", cat: "Aktivit√§t", subtag: "culture", title: "Time Travel Vienna", cost: 20, time: "1h", res: "Nein", address: "Habsburgergasse 10A, 1010 Wien", desc: "5D Show.", img: "timetr.jpg" },
            { id: "w_p1", lat: 48.2067, lng: 16.3605, city: "Wien", cat: "Party", subtag: "club", title: "Volksgarten", cost: 20, time: "Bis 05:00", res: "Nein", address: "Volksgarten, 1010 Wien", desc: "Schicker Club im Park.", img: "volksgarten.jpg" },
            { id: "w_p2", lat: 48.2348, lng: 16.3608, city: "Wien", cat: "Party", subtag: "club", title: "Grelle Forelle", cost: 20, time: "Bis 06:00", res: "Nein", address: "Spittelauer L√§nde 12, 1090 Wien", desc: "Techno, Fotoverbot.", img: "grellefo.jpg" },
            { id: "w_p3", lat: 48.1926, lng: 16.3377, city: "Wien", cat: "Party", subtag: "bar", title: "Travel Shack", cost: 5, time: "Bis 04:00", res: "Nein", address: "Mariahilfer G√ºrtel 21, 1150 Wien", desc: "Backpacker, Shots.", img: "travelsh.jpg" },
            { id: "w_p4", lat: 48.2072, lng: 16.3712, city: "Wien", cat: "Party", subtag: "bar", title: "Loos Bar", cost: 20, time: "1h", res: "Nein", address: "K√§rntner Durchgang 10, 1010 Wien", desc: "Architektur-Ikone.", img: "loosba.jpg" },
            { id: "w_p5", lat: 48.2065, lng: 16.3546, city: "Wien", cat: "Party", subtag: "bar", title: "Dachboden", cost: 20, time: "2h", res: "Nein", address: "Lerchenfelder Str. 1-3, 1070 Wien", desc: "Rooftop Bar.", img: "dachboden.jpg" },
            { id: "w_p6", lat: 48.2178, lng: 16.3602, city: "Wien", cat: "Party", subtag: "bar", title: "Krypt", cost: 25, time: "2h", res: "Nein", address: "Wasagasse 17, 1090 Wien", desc: "Kellerbar.", img: "krypt.jpg" },
            { id: "w_p7", lat: 48.2011, lng: 16.3695, city: "Wien", cat: "Party", subtag: "club", title: "Sass Music Club", cost: 15, time: "Bis 06:00", res: "Nein", address: "Karlsplatz 1, 1010 Wien", desc: "Elektronisch, intim.", img: "sassmu.jpg" },
            { id: "w_p8", lat: 48.2174, lng: 16.3974, city: "Wien", cat: "Party", subtag: "club", title: "Prater Dome", cost: 15, time: "Bis 05:00", res: "Nein", address: "Riesenradplatz 7, 1020 Wien", desc: "Gro√üraumdisco.", img: "praterdo.jpg" },
            { id: "w_p9", lat: 48.1875, lng: 16.4051, city: "Wien", cat: "Party", subtag: "club", title: "Louis Tomlinson", cost: 80, time: "Event", res: "Ticket", address: "Karl-Farkas-Gasse 19, 1030 Wien", desc: "Konzert Marx Halle.", img: "" },
            { id: "p_f1", lat: 50.0834, lng: 14.4287, city: "Prag", cat: "Essen", subtag: "casual", title: "Kant√Ωna", cost: 40, time: "1.5h", res: "Nein", address: "Politick√Ωch vƒõz≈à≈Ø 1511/5, 110 00 Prag", desc: "Carpaccio-Metzgerei in Bank.", img: "kantna.jpg" },
            { id: "p_f2", lat: 50.0907, lng: 14.4259, city: "Prag", cat: "Essen", subtag: "casual", title: "Lokal Dlouh√°√°√°", cost: 25, time: "Open End", res: "Empfohlen", address: "Dlouh√° 33, 110 00 Prag", desc: "Frischestes Pilsner Urquell.", img: "lokaldl.jpg" },
            { id: "p_f3", lat: 50.0801, lng: 14.4286, city: "Prag", cat: "Essen", subtag: "casual", title: "Vytopna Railway", cost: 35, time: "1.5h", res: "Empfohlen", address: "V√°clavsk√© n√°m. 802/56, 110 00 Prag", desc: "Wenzelsplatz. Getr√§nke kommen mit Modelleisenbahn.", img: "vytopnara.jpg" },
            { id: "p_f4", lat: 50.0913, lng: 14.4544, city: "Prag", cat: "Essen", subtag: "cafe", title: "Eska", cost: 40, time: "1.5h", res: "Empfohlen", address: "Pernerova 49, 186 00 Prag", desc: "Karl√≠n. Michelin Bib Gourmand, B√§ckerei-Restaurant.", img: "eska.jpg" },
            { id: "p_f5", lat: 50.0912, lng: 14.4268, city: "Prag", cat: "Essen", subtag: "street", title: "Na≈°e Maso", cost: 25, time: "30min", res: "Nein", address: "Dlouh√° 39, 110 00 Prag", desc: "Mini-Metzgerei. Hackbraten.", img: "naema.jpg" },
            { id: "p_f6", lat: 50.0917, lng: 14.4219, city: "Prag", cat: "Essen", subtag: "fine", title: "Field", cost: 120, time: "3h", res: "Zwingend", address: "U Milosrdn√Ωch 12, 110 00 Prag", desc: "Michelin Stern.", img: "field.jpg" },
            { id: "p_f7", lat: 50.0693, lng: 14.4036, city: "Prag", cat: "Essen", subtag: "street", title: "Manifesto Market", cost: 30, time: "1h", res: "Nein", address: "Ostrovsk√©ho 34, 150 00 Prag", desc: "Hipster Food Container Market.", img: "manifestoma.jpg" },
            { id: "p_f8", lat: 50.0855, lng: 14.4216, city: "Prag", cat: "Essen", subtag: "street", title: "Havelsk√° Koruna", cost: 10, time: "30min", res: "Nein", address: "Havelsk√° 21, 110 00 Prag", desc: "Tschechische Klassiker, Kantine, billig & schnell.", img: "havelskko.jpg" },
            { id: "p_f9", lat: 50.0904, lng: 14.4260, city: "Prag", cat: "Essen", subtag: "street", title: "Banh Mi Ba", cost: 15, time: "45min", res: "Nein", address: "Rybn√° 26, 110 00 Prag", desc: "Super vietnamesisches Essen (gro√üe Community in Prag).", img: "banhmi.jpg" },
            { id: "p_f10", lat: 50.0892, lng: 14.3979, city: "Prag", cat: "Essen", subtag: "casual", title: "Kuchy≈à", cost: 40, time: "1.5h", res: "Empfohlen", address: "Hradƒçansk√© n√°m. 1, 118 00 Prag", desc: "Auf der Burg. Tolle Aussicht, Essen aus T√∂pfen.", img: "kuchy.jpg" },
            { id: "p_f11", lat: 50.0874, lng: 14.4060, city: "Prag", cat: "Essen", subtag: "casual", title: "Pork's", cost: 30, time: "1.5h", res: "Empfohlen", address: "Mosteck√° 16, 118 00 Prag", desc: "Haxe.", img: "porks.jpg" },
            { id: "p_f12", lat: 50.0890, lng: 14.4320, city: "Prag", cat: "Essen", subtag: "fine", title: "Sia", cost: 50, time: "2h", res: "Empfohlen", address: "V Celnici 1034/6, 110 00 Prag", desc: "Asiatisch.", img: "sia.jpg" },
            { id: "p_f13", lat: 50.0812, lng: 14.4443, city: "Prag", cat: "Essen", subtag: "casual", title: "The Tavern", cost: 25, time: "1h", res: "Nein", address: "Chopinova 26, 120 00 Prag", desc: "Burger.", img: "theta.jpg" },
            { id: "p_f14", lat: 50.0771, lng: 14.4508, city: "Prag", cat: "Essen", subtag: "casual", title: "Kro Kitchen", cost: 25, time: "1h", res: "Nein", address: "Vinohradsk√° 66, 130 00 Prag", desc: "Rotisserie.", img: "kroki.jpg" },
            { id: "p_f15", lat: 50.0887, lng: 14.4274, city: "Prag", cat: "Essen", subtag: "casual", title: "T-Anker", cost: 30, time: "1.5h", res: "Empfohlen", address: "N√°mƒõst√≠ Republiky 8, 110 00 Prag", desc: "Dachterrasse.", img: "tanker.jpg" },
            { id: "p_f16", lat: 50.0755, lng: 14.4384, city: "Prag", cat: "Essen", subtag: "casual", title: "Vinohradsk√Ω Parlament", cost: 30, time: "1.5h", res: "Empfohlen", address: "Korunn√≠ 1, 120 00 Prag", desc: "Gute Kn√∂delgerichte.", img: "vinohradskpa.jpg" },
            { id: "p_f17", lat: 50.0715, lng: 14.4391, city: "Prag", cat: "Essen", subtag: "casual", title: "Las Adelitas", cost: 30, time: "1.5h", res: "Empfohlen", address: "Americk√° 8, 120 00 Prag", desc: "Guter Mexikaner.", img: "lasad.jpg" },
            { id: "p_f18", lat: 50.0995, lng: 14.4277, city: "Prag", cat: "Essen", subtag: "street", title: "Mr. HotDog", cost: 20, time: "1h", res: "Nein", address: "Kamenick√° 24, 170 00 Prag", desc: "Hotdogs.", img: "mrho.jpg" },
            { id: "p_f19", lat: 50.0912, lng: 14.4268, city: "Prag", cat: "Essen", subtag: "street", title: "Sisters Bistro", cost: 15, time: "30min", res: "Nein", address: "Dlouh√° 39, 110 00 Prag", desc: "Br√∂tchen.", img: "sistersbi.jpg" },
            { id: "p_f20", lat: 50.0801, lng: 14.4287, city: "Prag", cat: "Essen", subtag: "street", title: "Bageterie Boulevard", cost: 10, time: "15min", res: "Nein", address: "V√°clavsk√© n√°m. 56, 110 00 Prag", desc: "Baguettes.", img: "bageteriebo.jpg" },
            { id: "p_f21", lat: 50.0727, lng: 14.4037, city: "Prag", cat: "Essen", subtag: "street", title: "Burrito Loco", cost: 10, time: "15min", res: "Nein", address: "≈†tef√°nikova 230/7, 150 00 Prag", desc: "Burritos.", img: "burritolo.jpg" },
            { id: "p_f22", lat: 50.0858, lng: 14.4200, city: "Prag", cat: "Essen", subtag: "casual", title: "Bistro Monk", cost: 30, time: "1h", res: "Empfohlen", address: "Michalsk√° 20, 110 00 Prag", desc: "Fr√ºhst√ºck.", img: "bistromo.jpg" },
            { id: "p_f23", lat: 50.0843, lng: 14.4206, city: "Prag", cat: "Essen", subtag: "cafe", title: "Venue", cost: 30, time: "1h", res: "Nein", address: "Havelsk√° 4, 110 00 Prag", desc: "Brunch.", img: "venue.jpg" },
            { id: "p_f24", lat: 50.0898, lng: 14.4224, city: "Prag", cat: "Essen", subtag: "street", title: "Bakeshop", cost: 25, time: "30min", res: "Nein", address: "Koz√≠ 1, 110 00 Prag", desc: "B√§ckerei.", img: "bakeshop.jpg" },
            { id: "p_f25", lat: 50.0810, lng: 14.4072, city: "Prag", cat: "Essen", subtag: "cafe", title: "Caf√© Savoy", cost: 40, time: "1.5h", res: "Empfohlen", address: "V√≠tƒõzn√° 5, 150 00 Prag", desc: "Imperial.", img: "cafsa.jpg" },
            { id: "p_f26", lat: 50.0794, lng: 14.4189, city: "Prag", cat: "Essen", subtag: "street", title: "Super Tramp Coffee", cost: 10, time: "30min", res: "Nein", address: "Opatovick√° 160/18, 110 00 Prag", desc: "Kaffee.", img: "supertr.jpg" },
            { id: "p_f27", lat: 50.0753, lng: 14.4513, city: "Prag", cat: "Essen", subtag: "cafe", title: "Coffee Room", cost: 15, time: "45min", res: "Nein", address: "Korunn√≠ 74, 101 00 Prag", desc: "Avocado Toast.", img: "coffeero.jpg" },
            { id: "p_f28", lat: 50.0654, lng: 14.4199, city: "Prag", cat: "Essen", subtag: "casual", title: "U Kroka", cost: 25, time: "1.5h", res: "Zwingend", address: "Vratislavova 12/28, 128 00 Prag", desc: "Abseits des Zentrums. Top Preis.", img: "ukr.jpg" },
            { id: "p_f29", lat: 50.0841, lng: 14.4145, city: "Prag", cat: "Essen", subtag: "fine", title: "Lehk√° Hlava", cost: 30, time: "1.5h", res: "Empfohlen", address: "Bor≈°ov 280/2, 110 00 Prag", desc: "Vegetarisch, spacig.", img: "lehkhl.jpg" },
            { id: "p_a1", lat: 50.0880, lng: 14.4241, city: "Prag", cat: "Aktivit√§t", subtag: "relax", title: "Bier Spa Bernard", cost: 90, time: "1h", res: "Zwingend", address: "T√Ωn 10, 110 00 Prag", desc: "Baden in Bier.", img: "biersp.jpg" },
            { id: "p_a2", lat: 50.0813, lng: 14.4285, city: "Prag", cat: "Aktivit√§t", subtag: "culture", title: "Nuklearbunker Tour", cost: 25, time: "2h", res: "Ticket", address: "V√°clavsk√© n√°m. 45 (Hotel Jalta), 110 00 Prag", desc: "Ex-Sowjet Bunker.", img: "nuklearbunkerto.jpg" },
            { id: "p_a3", lat: 50.0789, lng: 14.4132, city: "Prag", cat: "Aktivit√§t", subtag: "relax", title: "Tretboot fahren", cost: 20, time: "1h", res: "Nein", address: "Slovansk√Ω ostrov, 110 00 Prag", desc: "Auf der Moldau (Slovansk√Ω Insel).", img: "tretbootfa.jpg" },
            { id: "p_a4", lat: 50.0813, lng: 14.4243, city: "Prag", cat: "Aktivit√§t", subtag: "culture", title: "Museum of Fantastic Illusions", cost: 15, time: "1h", res: "Nein", address: "Vodiƒçkova 31, 110 00 Prag", desc: "Lustige Fotos.", img: "museumofprag.jpg" },
            { id: "p_a5", lat: 50.0862, lng: 14.4138, city: "Prag", cat: "Aktivit√§t", subtag: "culture", title: "Altst√§dter Br√ºckenturm", cost: 10, time: "45min", res: "Nein", address: "Karl≈Øv most, 110 00 Prag", desc: "Aufstieg f√ºr den Karlsbr√ºcke-Blick.", img: "altstdterbr.jpg" },
            { id: "p_a6", lat: 50.0880, lng: 14.4300, city: "Prag", cat: "Aktivit√§t", subtag: "culture", title: "Museum des Kommunismus", cost: 15, time: "1.5h", res: "Nein", address: "V Celnici 1031/4, 110 00 Prag", desc: "Geschichte der CSSR.", img: "museumde.jpg" },
            { id: "p_a7", lat: 50.0871, lng: 14.4178, city: "Prag", cat: "Aktivit√§t", subtag: "culture", title: "Paternoster Aufzug", cost: 0, time: "15min", res: "Nein", address: "Mari√°nsk√© n√°m. 2, 110 00 Prag", desc: "Im Rathaus. Aufzug ohne T√ºren.", img: "paternosterau.jpg" },
            { id: "p_a8", lat: 50.1068, lng: 14.4476, city: "Prag", cat: "Aktivit√§t", subtag: "culture", title: "DOX Centre for Art", cost: 20, time: "2h", res: "Nein", address: "Poupƒõtova 1, 170 00 Prag", desc: "Hole≈°ovice. Luftschiff auf dem Dach.", img: "doxce.jpg" },
            { id: "p_a9", lat: 50.0787, lng: 14.4028, city: "Prag", cat: "Aktivit√§t", subtag: "culture", title: "Magical Cavern", cost: 10, time: "45min", res: "Nein", address: "Pet≈ô√≠n, 118 00 Prag", desc: "Psychedelisch.", img: "magicalca.jpg" },
            { id: "p_a10", lat: 50.0874, lng: 14.4174, city: "Prag", cat: "Aktivit√§t", subtag: "culture", title: "Idiom Installation", cost: 0, time: "15min", res: "Nein", address: "Mari√°nsk√© n√°m. 1, 110 00 Prag", desc: "Unendlicher B√ºcherturm in der Bibliothek.", img: "idiomin.jpg" },
            { id: "p_a11", lat: 50.0810, lng: 14.4511, city: "Prag", cat: "Aktivit√§t", subtag: "culture", title: "Fernsehturm ≈Ωi≈ækov", cost: 15, time: "1h", res: "Nein", address: "Mahlerovy sady 1, 130 00 Prag", desc: "Babys.", img: "fernsehturmik.jpg" },
            { id: "p_a12", lat: 50.0981, lng: 14.4142, city: "Prag", cat: "Aktivit√§t", subtag: "relax", title: "Letn√° Park", cost: 0, time: "1h", res: "Nein", address: "Letn√°, 170 00 Prag", desc: "Metronom.", img: "letnpa.jpg" },
            { id: "p_a13", lat: 50.0861, lng: 14.4065, city: "Prag", cat: "Aktivit√§t", subtag: "culture", title: "John Lennon Wall", cost: 0, time: "30min", res: "Nein", address: "Velkop≈ôevorsk√© n√°m., 118 00 Prag", desc: "Graffiti.", img: "johnle.jpg" },
            { id: "p_a14", lat: 50.0891, lng: 14.4287, city: "Prag", cat: "Aktivit√§t", subtag: "relax", title: "Palladium", cost: 0, time: "1h", res: "Nein", address: "N√°mƒõst√≠ Republiky 1, 110 00 Prag", desc: "Shopping.", img: "palladium.jpg" },
            { id: "p_a15", lat: 50.0789, lng: 14.4310, city: "Prag", cat: "Aktivit√§t", subtag: "culture", title: "Nationalmuseum", cost: 20, time: "2h", res: "Nein", address: "V√°clavsk√© n√°m. 68, 110 00 Prag", desc: "Prunkbau.", img: "nationalmuseum.jpg" },
            { id: "p_a16", lat: 50.0526, lng: 14.4146, city: "Prag", cat: "Aktivit√§t", subtag: "relax", title: "Sauna Spot Dvorce", cost: 35, time: "2h", res: "Empfohlen", address: "Podolsk√© n√°b≈ô. 1184/5, 147 00 Prag", desc: "Sauna an der Moldau.", img: "saunasp.jpg" },
            { id: "p_a17", lat: 49.2434, lng: 16.5155, city: "Prag", cat: "Aktivit√§t", subtag: "relax", title: "Infinit Maximus", cost: 50, time: "4h", res: "Empfohlen", address: "Hr√°zn√≠ 327/4a, 635 00 Brno", desc: "Riesige Saunawelt.", img: "infinitma.jpg" },
            { id: "p_p1", lat: 50.1082, lng: 14.4432, city: "Prag", cat: "Party", subtag: "club", title: "Cross Club", cost: 15, time: "Bis 06:00", res: "Nein", address: "Plyn√°rn√≠ 1096/23, 170 00 Prag", desc: "Steampunk D&B.", img: "crosscl.jpg" },
            { id: "p_p2", lat: 50.0840, lng: 14.4143, city: "Prag", cat: "Party", subtag: "bar", title: "Hemingway Bar", cost: 40, time: "2h", res: "Zwingend", address: "Karol√≠ny Svƒõtl√© 26, 110 00 Prag", desc: "Absinth-Cocktails.", img: "hemingwayba.jpg" },
            { id: "p_p3", lat: 50.0852, lng: 14.4200, city: "Prag", cat: "Party", subtag: "bar", title: "Anonymous Bar", cost: 30, time: "2h", res: "Empfohlen", address: "Michalsk√° 12, 110 00 Prag", desc: "Hidden Bar.", img: "anonymousba.jpg" },
            { id: "p_p4", lat: 50.0790, lng: 14.4222, city: "Prag", cat: "Party", subtag: "bar", title: "U Sudu", cost: 10, time: "Open End", res: "Nein", address: "Vodiƒçkova 677/10, 110 00 Prag", desc: "H√∂hlenbar.", img: "usu.jpg" },
            { id: "p_p5", lat: 50.0768, lng: 14.4082, city: "Prag", cat: "Party", subtag: "bar", title: "Jazz Dock", cost: 25, time: "2h", res: "Ticket", address: "Jan√°ƒçkovo n√°b≈ô. 3249/2, 150 00 Prag", desc: "Am Wasser.", img: "jazzdo.jpg" },
            { id: "p_p6", lat: 50.0864, lng: 14.4202, city: "Prag", cat: "Party", subtag: "club", title: "Black Angel's", cost: 40, time: "2h", res: "Nein", address: "Staromƒõstsk√© n√°m. 29, 110 00 Prag", desc: "Gothic.", img: "blackan.jpg" },
            { id: "p_p7", lat: 50.0854, lng: 14.4139, city: "Prag", cat: "Party", subtag: "club", title: "Karlovy Lazne", cost: 25, time: "Bis 05:00", res: "Nein", address: "Novotn√©ho l√°vka 198/5, 110 00 Prag", desc: "5-Stock.", img: "karlovyla.jpg" },
            { id: "p_p8", lat: 50.0625, lng: 14.4297, city: "Prag", cat: "Party", subtag: "club", title: "Paul Simon Konzert", cost: 90, time: "Event", res: "Ticket", address: "Kongresszentrum, Prag", desc: "Konzert.", img: "" }, 
            { id: "p_p9", lat: 50.0898, lng: 14.4278, city: "Prag", cat: "Party", subtag: "club", title: "Epic Prague", cost: 25, time: "Bis 05:00", res: "Ticket", address: "Revoluƒçn√≠ 1003/3, 110 00 Prag", desc: "EDM.", img: "epicpr.jpg" }
        ];

        // --- COMPONENTS ---

        const Icon = ({ name, className }) => {
            React.useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        const Toast = ({ message, isVisible, onClose }) => {
            useEffect(() => {
                if (isVisible) {
                    const timer = setTimeout(onClose, 3000);
                    return () => clearTimeout(timer);
                }
            }, [isVisible, onClose]);

            if (!isVisible) return null;

            return (
                <div className="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-xl z-[9999] text-sm font-bold flex items-center gap-2 toast-enter dark:bg-rose-900 dark:text-white dark:border dark:border-rose-700">
                    <span>{message}</span>
                </div>
            );
        };
        
const CurrencyConverter = ({ city }) => {
    const [amount, setAmount] = useState('');
    const [currency, setCurrency] = useState('CHF');
    
    const handleConvert = (targetCurr) => {
        if (!amount) return '---';
        const val = parseFloat(amount);
        if (isNaN(val)) return '---';
        
        let inCHF = val;
        if (currency !== 'CHF') {
            inCHF = val / FX_RATES[currency];
        }
        
        if (targetCurr === 'CHF') return inCHF.toFixed(2);
        
        return Math.round(inCHF * FX_RATES[targetCurr]).toLocaleString();
    };

    // Calculate Beer Index
    let beerPriceCHF = 0;
    if (city === 'Budapest') beerPriceCHF = 2.5;
    else if (city === 'Wien') beerPriceCHF = 5.5;
    else if (city === 'Prag') beerPriceCHF = 2.2;
    
    const beersFor10CHF = beerPriceCHF > 0 ? (10 / beerPriceCHF).toFixed(1) : '-';

    // Bestimme welche 3 W√§hrungen angezeigt werden sollen (nie die Input-W√§hrung)
    const allCurrencies = ['CHF', 'HUF', 'EUR', 'CZK'];
    const displayCurrencies = allCurrencies.filter(c => c !== currency).slice(0, 3);

    return (
        <div className="flex flex-col sm:flex-row items-center gap-3 bg-white/80 dark:bg-slate-800/80 backdrop-blur-md p-3 rounded-2xl border border-rose-100 dark:border-slate-700 shadow-sm text-xs font-medium w-full sm:w-auto">
            <div className="flex items-center gap-2 bg-slate-50 dark:bg-slate-700 px-3 py-1.5 rounded-xl border border-slate-200 dark:border-slate-600 w-full sm:w-auto">
                <input 
                    type="number" 
                    placeholder="100" 
                    className="w-16 bg-transparent outline-none font-mono font-bold text-slate-700 dark:text-slate-200"
                    value={amount}
                    onChange={(e) => setAmount(e.target.value)}
                />
                <select 
                    value={currency} 
                    onChange={(e) => setCurrency(e.target.value)}
                    className="bg-transparent outline-none text-slate-500 dark:text-slate-400 font-bold cursor-pointer"
                >
                    <option value="CHF">CHF</option>
                    <option value="HUF">HUF</option>
                    <option value="EUR">EUR</option>
                    <option value="CZK">CZK</option>
                </select>
            </div>
            
            <div className="flex gap-3 w-full justify-between sm:justify-start text-slate-700 dark:text-slate-300">
                 {/* Zeige die 3 anderen W√§hrungen (nicht die Input-W√§hrung) */}
                 {displayCurrencies.map(curr => (
                     <div key={curr} className="flex flex-col items-center bg-slate-50 dark:bg-slate-700 px-2 py-1 rounded-lg">
                        <span className="text-[9px] text-slate-400 font-bold uppercase">{curr}</span>
                        <span className="font-mono text-xs">{handleConvert(curr)}</span>
                    </div>
                 ))}
                
                {/* Beer Index */}
                <div className="w-px h-8 bg-slate-200 dark:bg-slate-600"></div>
                <div className="flex flex-col items-center" title="Bier-Index: Wie viel Bier kriegst du f√ºr 10 CHF?">
                     <span className="text-[10px] text-amber-500 font-bold uppercase">Bier f√ºr 10 CHF</span>
                     <span className="font-bold text-lg">{beersFor10CHF} üç∫</span>
                </div>
            </div>
        </div>
    );
};
const EmergencyModal = ({ isOpen, onClose, city }) => {
    const emergencyInfo = {
        "Budapest": {
            emergency: "112",
            embassy: "Schwefelquelle utca 14, 1025 Budapest",
            embassyPhone: "+36 1 460 0700",
            helpPhrase: "Seg√≠ts√©gre van sz√ºks√©gem"
        },
        "Wien": {
            emergency: "112",
            embassy: "Prinz-Eugen-Stra√üe 7, 1030 Wien",
            embassyPhone: "+43 1 795 05 0",
            helpPhrase: "Ich brauche Hilfe"
        },
        "Prag": {
            emergency: "112",
            embassy: "Pevnostn√≠ 7, 162 00 Praha 6",
            embassyPhone: "+420 220 400 611",
            helpPhrase: "Pot≈ôebuji pomoc"
        }
    };
    
    const info = emergencyInfo[city] || emergencyInfo["Budapest"];
    
    const speak = (text) => {
        if ('speechSynthesis' in window) {
            const u = new SpeechSynthesisUtterance(text);
            u.lang = city === "Budapest" ? "hu-HU" : city === "Wien" ? "de-AT" : "cs-CZ";
            window.speechSynthesis.speak(u);
        }
    };
    
    if (!isOpen) return null;
    
    return (
        <div className="fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-slate-900/90 backdrop-blur-sm modal-enter" onClick={onClose}>
            <div className="bg-white dark:bg-slate-800 rounded-3xl w-full max-w-sm p-6 shadow-2xl relative border-4 border-red-500" onClick={e => e.stopPropagation()}>
                <button onClick={onClose} className="absolute top-4 right-4 p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full">
                    <Icon name="x" className="w-5 h-5 text-slate-400"/>
                </button>
                
                <div className="text-center mb-6">
                    <div className="text-5xl mb-2">üõ°Ô∏è</div>
                    <h3 className="text-xl font-bold text-red-600 dark:text-red-400">Emergency Info</h3>
                    <p className="text-xs text-slate-500 dark:text-slate-400 mt-1">{city}</p>
                </div>
                
                <div className="space-y-4">
                    <div className="bg-red-50 dark:bg-red-900/20 p-4 rounded-xl border-2 border-red-200 dark:border-red-800">
                        <div className="text-xs font-bold text-red-800 dark:text-red-300 uppercase mb-1">Notruf</div>
                        <a href={`tel:${info.emergency}`} className="text-3xl font-black text-red-600 dark:text-red-400">{info.emergency}</a>
                    </div>
                    
                    <div className="bg-slate-50 dark:bg-slate-700 p-4 rounded-xl">
                        <div className="text-xs font-bold text-slate-600 dark:text-slate-300 uppercase mb-2 flex items-center gap-1">
                            <Icon name="flag" className="w-3 h-3"/> Schweizer Botschaft
                        </div>
                        <p className="text-sm text-slate-700 dark:text-slate-200 mb-2">{info.embassy}</p>
                        <a href={`tel:${info.embassyPhone}`} className="text-sm font-bold text-rose-600 dark:text-rose-400">{info.embassyPhone}</a>
                    </div>
                    
                    <div 
                        className="bg-amber-50 dark:bg-amber-900/20 p-4 rounded-xl cursor-pointer hover:bg-amber-100 dark:hover:bg-amber-900/30 transition-colors border border-amber-200 dark:border-amber-800"
                        onClick={() => speak(info.helpPhrase)}
                    >
                        <div className="text-xs font-bold text-amber-800 dark:text-amber-300 uppercase mb-1 flex items-center gap-1">
                            <Icon name="volume-2" className="w-3 h-3"/> Sag das den Locals
                        </div>
                        <p className="text-lg font-bold text-amber-900 dark:text-amber-200">"{info.helpPhrase}"</p>
                    </div>
                </div>
            </div>
        </div>
    );
};

const EmergencyButton = ({ onClick }) => (
    <button 
        onClick={onClick}
        className="bg-red-600 hover:bg-red-700 text-white p-4 rounded-full shadow-xl transition-transform hover:scale-110 flex items-center justify-center mb-2"
        title="Notfall & Botschaft"
    >
        <span className="text-2xl">üõ°Ô∏è</span>
    </button>
);
        const TikTokIcon = () => (
            <svg viewBox="0 0 24 24" fill="currentColor" className="w-3 h-3">
                <path d="M12.525.02c1.31-.02 2.61-.01 3.918.02.08 1.84 1.256 3.24 3.42 3.74V7.9c-1.63-.02-2.924-.6-3.879-1.92V12.9c0 3.32-3.11 5.76-6.618 4.69C7.38 17 6.13 14.88 7.5 12.3c.75-1.42 2.13-2.22 3.82-2.06V7c-3.14-.35-6.66 2.36-6.62 6.58.04 4.34 4.29 7.37 8.28 6.44 3.2-.74 5.38-3.9 5.25-7.74V4.68c2.16.03 4.14 1.3 5.09 3.5v-4.8c-.85-.18-1.7-.28-2.56-.28-1.5 0-2.88.58-4.04 1.58V0h-3.918z"/>
            </svg>
        );

        const GoogleIcon = () => (
            <svg viewBox="0 0 24 24" className="w-3 h-3">
                <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.84z" fill="#FBBC05"/>
                <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
            </svg>
        );

        // --- MAP COMPONENT ---
        const MapView = ({ items, activeCity, drunkMode }) => {
            const mapRef = useRef(null);
            const markersRef = useRef(L.featureGroup());
            const mapContainerRef = useRef(null);
            const mapInstanceRef = useRef(null);
            const markersLayerRef = useRef(null);


            // Coordinates for cities
            const CITY_COORDS = {
                "Budapest": [47.4979, 19.0402],
                "Wien": [48.2082, 16.3738],
                "Prag": [50.0755, 14.4378],
                "Transfer": [48.2082, 16.3738]
            };

            const getMapEmoji = (item) => {
                if (item.cat === 'Hotel') return 'üõèÔ∏è';
                if (item.cat === 'Party') return 'üç∏';
                if (item.cat === 'Aktivit√§t') return 'üè∞';
                if (item.cat === 'Transport') return 'üöÜ';

                if (item.cat === 'Essen') {
                    const lowerTitle = item.title.toLowerCase();
                    const lowerDesc = item.desc.toLowerCase();
                    
                    if (item.subtag === 'cafe' || lowerTitle.includes('cafe') || lowerTitle.includes('coffee') || lowerDesc.includes('fr√ºhst√ºck') || lowerDesc.includes('brunch') || lowerDesc.includes('b√§ckerei')) {
                        return 'ü•ê';
                    }
                    if (item.subtag === 'street' || lowerTitle.includes('burger') || lowerTitle.includes('pizza') || lowerDesc.includes('hotdog')) {
                        return 'üçî';
                    }
                    return 'ü•ò';
                }
                return 'üìç';
            };

            useEffect(() => {
                if (mapInstanceRef.current) return;

                const map = L.map(mapContainerRef.current, { zoomControl: false }).setView(CITY_COORDS["Budapest"], 13);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; OpenStreetMap',
                    subdomains: 'abcd',
                    maxZoom: 20
                }).addTo(map);
                L.control.zoom({ position: 'bottomright' }).addTo(map);
                
                // Location Found Event & Distance Radar
                map.on('locationfound', (e) => {
                     L.circle(e.latlng, { radius: e.accuracy / 2, color: '#f43f5e', fillColor: '#f43f5e', fillOpacity: 0.2 }).addTo(map);
                     L.circleMarker(e.latlng, { radius: 8, color: '#fff', fillColor: '#f43f5e', fillOpacity: 1 }).bindPopup("Du bist hier!").addTo(map).openPopup();
                     map.flyTo(e.latlng, 15);

                     // Distance Radar Logic
                     let nearestDist = Infinity;
                     let nearestName = "";

                     items.forEach(i => {
                        if (i.lat && i.lng && (i.cat === 'Party' || i.cat === 'Essen')) {
                            const dist = map.distance(e.latlng, [i.lat, i.lng]);
                            if (dist < nearestDist) {
                                nearestDist = dist;
                                nearestName = i.title;
                            }
                        }
                     });

                     // Dispatch custom event to update Radar UI outside map
                     const event = new CustomEvent('radarUpdate', { detail: { dist: nearestDist, name: nearestName } });
                     window.dispatchEvent(event);
                    // Check for stamp unlocks
                     if (window.checkStampUnlock) {
                         window.checkStampUnlock(e.latlng.lat, e.latlng.lng);
                     }
                });
                 
                map.on('locationerror', (e) => {
                    alert("Standort konnte nicht ermittelt werden. Bitte GPS erlauben.");
                });
                
                const markers = L.featureGroup().addTo(map);
                
                mapInstanceRef.current = map;
                markersLayerRef.current = markers;

                return () => {
                    if (mapInstanceRef.current) {
                        mapInstanceRef.current.remove();
                        mapInstanceRef.current = null;
                    }
                }
            }, []);
            
            useEffect(() => {
                const map = mapInstanceRef.current;
                if (!map) return;
                
                if (CITY_COORDS[activeCity]) {
                    map.flyTo(CITY_COORDS[activeCity], 13, { duration: 1.5 });
                }

                const markersLayer = markersLayerRef.current;
                markersLayer.clearLayers();

                items.forEach(item => {
                    // Drunk Mode Filter: Show only Hotel + Street Food
                    if (drunkMode) {
                        const isHotel = item.cat === 'Hotel';
                        const isStreetFood = item.subtag === 'street';
                        if (!isHotel && !isStreetFood) return;
                    }

                    if (item.lat && item.lng && item.lat !== 0) {
                        const emoji = getMapEmoji(item);
                        const iconHtml = `<div class="emoji-marker" style="font-size: ${drunkMode ? '40px' : '28px'}">${emoji}</div>`;
                        const customIcon = L.divIcon({
                            html: iconHtml,
                            className: 'bg-transparent',
                            iconSize: [30, 30],
                            iconAnchor: [15, 15],
                            popupAnchor: [0, -10]
                        });

                        const marker = L.marker([item.lat, item.lng], { icon: customIcon });
                        
                        const popupContent = `
                            <div style="border-radius: 12px; overflow: hidden;">
                                <div style="height: 100px; background-image: url('${item.img || ''}'); background-size: cover; background-position: center; position: relative;">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); padding: 8px;">
                                        <div style="color: white; font-weight: bold; font-family: 'Quicksand';">${item.title}</div>
                                    </div>
                                </div>
                                <div class="popup-content">
                                    <div style="font-size: 10px; color: #888; text-transform: uppercase; font-weight: bold;">${item.cat} ‚Ä¢ ${item.subtag || ''}</div>
                                    <div style="font-size: 12px; color: #444; margin: 4px 0;">${item.desc}</div>
                                    <a href="https://maps.google.com/?q=${item.lat},${item.lng}" target="_blank" style="display: block; margin-top: 8px; text-align: center; background: #e11d48; color: white; padding: 4px; border-radius: 6px; text-decoration: none; font-size: 11px; font-weight: bold;">üìç Google Maps</a>
                                </div>
                            </div>
                        `;
                        
                        marker.bindPopup(popupContent);
                        marker.bindTooltip(item.title, { direction: 'top', offset: [0, -20], opacity: 0.9 });
                        markersLayer.addLayer(marker);
                    }
                });

            }, [items, activeCity, drunkMode]);

            const handleLocateMe = () => {
                if (mapInstanceRef.current) {
                    mapInstanceRef.current.locate({setView: true, maxZoom: 16});
                }
            };
            
            const [radarInfo, setRadarInfo] = useState(null);
            
            useEffect(() => {
                const handleRadar = (e) => {
                    if (e.detail.dist < 5000) {
                        setRadarInfo(e.detail);
                    } else {
                        setRadarInfo(null);
                    }
                };
                window.addEventListener('radarUpdate', handleRadar);
                return () => window.removeEventListener('radarUpdate', handleRadar);
            }, []);

            return (
                <div className="relative w-full h-full">
                    <div ref={mapContainerRef} id="map-container"></div>
                    
                    {/* Distance Radar Overlay */}
                    {radarInfo && (
                        <div className="absolute top-4 left-4 z-[500] bg-white/90 backdrop-blur px-4 py-2 rounded-xl text-sm font-bold text-rose-700 shadow-lg border border-rose-200 animate-pulse">
                            üì° {Math.round(radarInfo.dist)}m bis {radarInfo.name} üç∫
                        </div>
                    )}
                    
                    <button 
                        onClick={handleLocateMe}
                        className="absolute top-4 right-4 z-[500] bg-white p-2 rounded-xl shadow-lg border border-slate-200 text-slate-700 hover:bg-slate-50 transition-colors dark:bg-slate-800 dark:border-slate-700 dark:text-white"
                        title="Mein Standort"
                    >
                        <Icon name="crosshair" className="w-5 h-5" />
                    </button>
                    {/* Get Me Home Button - nur im Drunk Mode */}
                    {drunkMode && (
                        <button 
                            onClick={() => {
                                const hotelCoords = {
                                    "Budapest": [47.4965, 19.0629],
                                    "Wien": [48.1936, 16.3547],
                                    "Prag": [50.0755, 14.4378]
                                };
                                const coords = hotelCoords[activeCity] || hotelCoords["Budapest"];
                                window.open(`https://www.google.com/maps/dir/?api=1&destination=${coords[0]},${coords[1]}&travelmode=walking`, '_blank');
                            }}
                            className="absolute top-20 left-1/2 transform -translate-x-1/2 z-[500] bg-neon-pink text-black px-8 py-4 rounded-2xl shadow-2xl border-4 border-neon-green font-black text-xl animate-pulse hover:scale-110 transition-transform"
                            title="Bring mich heim!"
                        >
                            üöï BRING MICH HEIM
                        </button>
                    )}
                </div>
            );
        };

        const SurvivalDictionary = ({ city }) => {
            const [isOpen, setIsOpen] = useState(false);
            const dict = DICTIONARY[city] || DICTIONARY["Transfer"];

            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    const u = new SpeechSynthesisUtterance(text);
                    u.lang = dict.lang || 'en-US';
                    window.speechSynthesis.speak(u);
                }
            };

            return (
                <div className="fixed bottom-6 right-6 z-[100] flex flex-col gap-2 items-end">
                    
                    {isOpen && (
                        <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-4 w-64 border border-rose-100 dark:border-slate-700 mb-2 modal-enter text-slate-800 dark:text-slate-200">
                             <div className="flex justify-between items-center mb-2 border-b border-rose-100 dark:border-slate-700 pb-1">
                                <h3 className="font-bold text-rose-900 dark:text-rose-400">Survival Kit: {city}</h3>
                                <button onClick={() => setIsOpen(false)} className="p-1 hover:bg-rose-50 dark:hover:bg-slate-700 rounded-full"><Icon name="x" className="w-4 h-4 text-slate-400"/></button>
                            </div>
                            <div className="space-y-2 text-sm">
                                {Object.entries(dict).filter(([key]) => key !== 'lang').map(([key, val]) => (
                                    <div key={key} className="flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 p-1 rounded" onClick={() => speak(val)}>
                                        <span className="text-slate-500 dark:text-slate-400 capitalize">{key}:</span>
                                        <div className="flex items-center gap-1">
                                            <span className="font-bold">{val}</span>
                                            <Icon name="volume-2" className="w-3 h-3 text-rose-400"/>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                    <button 
                        onClick={() => setIsOpen(!isOpen)}
                        className="bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-full shadow-xl transition-transform hover:scale-110 flex items-center justify-center"
                        title="W√∂rterbuch"
                    >
                        <span className="text-2xl">üó£Ô∏è</span>
                    </button>
                </div>
            );
        };

        const ChallengeButton = () => {
            const [showModal, setShowModal] = useState(false);
            const [challenge, setChallenge] = useState("");

            const handleChallenge = () => {
                // Fixed teaser logic: always show the first one if trip hasn't started
                const now = new Date();
                const start = new Date('2026-04-01');
                
                if (now < start) {
                    setChallenge(CHALLENGES[0]); 
                } else {
                     const random = CHALLENGES[Math.floor(Math.random() * CHALLENGES.length)];
                     setChallenge(random);
                }
                setShowModal(true);
            };

            return (
                <>
                    <button 
                        onClick={handleChallenge}
                        className="fixed bottom-24 right-6 z-[90] bg-rose-500 hover:bg-rose-600 text-white p-4 rounded-full shadow-xl transition-transform hover:scale-110 flex items-center justify-center"
                        title="Tages Challenge"
                    >
                        <span className="text-2xl">üé≤</span>
                    </button>

                    {showModal && (
                        <div className="fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm modal-enter" onClick={() => setShowModal(false)}>
                            <div className="bg-white dark:bg-slate-800 rounded-3xl w-full max-w-sm p-6 text-center shadow-2xl relative border-4 border-rose-200 dark:border-rose-900" onClick={e => e.stopPropagation()}>
                                <button onClick={() => setShowModal(false)} className="absolute top-4 right-4 p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full"><Icon name="x" className="w-5 h-5 text-slate-400"/></button>
                                <div className="text-4xl mb-4">üé≤</div>
                                <h3 className="text-xl font-bold text-rose-600 dark:text-rose-400 mb-2">Daily Challenge</h3>
                                <p className="text-slate-600 dark:text-slate-300 text-sm mb-4">
                                    Vorgeschmack f√ºr Bingus & Amor:
                                </p>
                                <div className="bg-rose-50 dark:bg-slate-700 p-4 rounded-xl border border-rose-100 dark:border-slate-600 mb-6">
                                    <p className="font-bold text-lg text-slate-800 dark:text-white leading-relaxed">"{challenge}"</p>
                                </div>
                                <div className="text-xs text-slate-500 dark:text-slate-400 italic mb-4">
                                    (Beispiel-Challenge - Spoilerschutz aktiv)
                                </div>
                                <button onClick={() => setShowModal(false)} className="bg-slate-900 dark:bg-rose-600 text-white px-6 py-2 rounded-lg font-bold text-sm w-full">Challenge Accepted!</button>
                            </div>
                        </div>
                    )}
                </>
            );
        };

        const CountDown = () => {
            const [timeLeft, setTimeLeft] = useState({ days: 0, hours: 0, minutes: 0, seconds: 0 });

            useEffect(() => {
                const interval = setInterval(() => {
                    const now = new Date();
                    // ZIELZEIT: 1. April 2026, 18:30 Uhr (Abflug Basel)
                    const target = new Date('2026-04-01T18:25:00');
                    const diff = target - now;
                    
                    if (diff > 0) {
                        setTimeLeft({
                            days: Math.floor(diff / (1000 * 60 * 60 * 24)),
                            hours: Math.floor((diff / (1000 * 60 * 60)) % 24),
                            minutes: Math.floor((diff / 1000 / 60) % 60),
                            seconds: Math.floor((diff / 1000) % 60),
                        });
                    } else {
                        // Trip hat begonnen
                        setTimeLeft({ days: 0, hours: 0, minutes: 0, seconds: 0 });
                    }
                }, 1000);
                return () => clearInterval(interval);
            }, []);

            return (
                <div className="flex gap-2 text-xs font-mono font-bold text-rose-500 dark:text-rose-300 mt-1 bg-white/50 dark:bg-black/30 px-3 py-1.5 rounded-lg backdrop-blur-sm border border-rose-100 dark:border-rose-900/50 inline-flex items-center shadow-sm">
                    <span className="flex items-center gap-1">
                         ‚úàÔ∏è <span className="bg-rose-50 dark:bg-rose-900/40 px-1.5 py-0.5 rounded text-rose-600 dark:text-rose-200">{timeLeft.days}d</span>
                    </span> :
                    <span>{String(timeLeft.hours).padStart(2, '0')}h</span> :
                    <span>{String(timeLeft.minutes).padStart(2, '0')}m</span> :
                    <span className="w-6 text-right font-black text-rose-600 dark:text-rose-400 animate-pulse">{String(timeLeft.seconds).padStart(2, '0')}s</span>
                </div>
            );
        };
        
        // --- Renamed FoodRouletteButton for consistency ---
        const FoodRouletteButton = ({ spin }) => (
             <button 
                onClick={spin}
                className="px-3 py-1.5 rounded-lg text-xs font-bold transition-all bg-amber-100 text-amber-700 hover:bg-amber-200 dark:bg-amber-900/40 dark:text-amber-400 dark:hover:bg-amber-900/60 flex items-center gap-1 shadow-sm hover:shadow-md transform hover:-translate-y-0.5"
                title="Food Roulette"
            >
                <span>üé≤</span> Hunger?
            </button>
        );

        const AlcoholTrackerButton = ({ onOpen }) => (
           <button 
                onClick={onOpen}
                className="bg-amber-500 hover:bg-amber-600 text-white p-2.5 rounded-2xl shadow-sm transition-all hover:scale-105 flex items-center justify-center"
                title="Pegel Tracker"
            >
                <span className="text-lg">üç∫</span>
            </button>
        );

        const AlcoholTrackerModal = ({ isOpen, onClose }) => {
            const [sessionCounts, setSessionCounts] = useState({ beer: 0, wine: 0, shots: 0, cocktails: 0 });
            const [totalCounts, setTotalCounts] = useState({ beer: 0, wine: 0, shots: 0, cocktails: 0 });

            // Load totals from local storage on mount
            useEffect(() => {
                const savedTotals = localStorage.getItem('alcohol_stats_total');
                if (savedTotals) {
                    setTotalCounts(JSON.parse(savedTotals));
                }
            }, []);

            // Save totals whenever they change
            useEffect(() => {
                localStorage.setItem('alcohol_stats_total', JSON.stringify(totalCounts));
            }, [totalCounts]);

            const updateCount = (type, delta) => {
                // Update session
                const newSessionVal = Math.max(0, sessionCounts[type] + delta);
                setSessionCounts(prev => ({ ...prev, [type]: newSessionVal }));
                
                // Update total (only add if delta > 0, subtract if delta < 0 and session > 0)
                if (delta > 0) {
                     setTotalCounts(prev => ({ ...prev, [type]: prev[type] + 1 }));
                } else if (delta < 0 && sessionCounts[type] > 0) {
                     // Correction logic: remove from total if removing from session
                     setTotalCounts(prev => ({ ...prev, [type]: Math.max(0, prev[type] - 1) }));
                }
            };

            const resetSession = () => {
                if(confirm("Neuer Tag starten? Die 'Heute' Z√§hler werden zur√ºckgesetzt, aber der 'Total Trip' bleibt.")) {
                    setSessionCounts({ beer: 0, wine: 0, shots: 0, cocktails: 0 });
                }
            };

            const totalDrinks = sessionCounts.beer + sessionCounts.wine + sessionCounts.shots + sessionCounts.cocktails;
            let status = "N√ºchtern";
            if (totalDrinks > 1) status = "Warmup üèéÔ∏è";
            if (totalDrinks > 3) status = "Leicht einen sitzen ü•¥";
            if (totalDrinks > 4) status = "Gut dabei ü•≥";
            if (totalDrinks > 5) status = "Spricht flie√üend Ungarisch üá≠üá∫";
            if (totalDrinks > 7) status = "Crazy Makeout Sesh??";
            if (totalDrinks > 8) status = "Amor muss tragen üíò";
            if (totalDrinks > 10) status = "GAME OVER üíÄ";

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm modal-enter" onClick={onClose}>
                     <div className="bg-white dark:bg-slate-800 rounded-3xl w-full max-w-sm p-6 shadow-2xl relative border-4 border-rose-200 dark:border-rose-900" onClick={e => e.stopPropagation()}>
                        <button onClick={onClose} className="absolute top-4 right-4 p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full"><Icon name="x" className="w-5 h-5 text-slate-400"/></button>
                        
                        <h3 className="text-xl font-bold text-rose-900 dark:text-rose-400 mb-6 text-center">Pegel-Rechner üç∫</h3>
                        
                        {/* Headers */}
                         <div className="flex justify-between px-3 mb-2 text-[10px] uppercase font-bold text-slate-400">
                             <span>Drink</span>
                             <div className="flex gap-4">
                                 <span>Heute</span>
                                 <span>Total</span>
                             </div>
                         </div>

                        <div className="space-y-3 mb-6">
                            {Object.entries(sessionCounts).map(([type, count]) => (
                                <div key={type} className="flex justify-between items-center bg-slate-50 dark:bg-slate-700 p-3 rounded-xl">
                                    <span className="capitalize font-bold text-slate-700 dark:text-slate-200">{type}</span>
                                    
                                    <div className="flex items-center gap-3">
                                        <div className="flex items-center gap-2 mr-2">
                                            <button onClick={() => updateCount(type, -1)} className="w-8 h-8 bg-white dark:bg-slate-600 rounded-full flex items-center justify-center font-bold shadow-sm hover:bg-slate-200">-</button>
                                            <span className="w-6 text-center font-mono font-bold text-lg">{count}</span>
                                            <button onClick={() => updateCount(type, 1)} className="w-8 h-8 bg-rose-100 dark:bg-rose-900/50 text-rose-600 rounded-full flex items-center justify-center font-bold shadow-sm hover:bg-rose-200">+</button>
                                        </div>
                                        <span className="w-8 text-center font-mono text-slate-400 text-sm border-l border-slate-300 pl-2">{totalCounts[type]}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                        
                        <div className="text-center pt-4 border-t border-slate-100 dark:border-slate-700">
                            <div className="text-xs text-slate-500 uppercase tracking-wider mb-1">Diagnose</div>
                            <div className="font-black text-lg text-rose-500 animate-pulse mb-4">{status}</div>
                            
                            <button 
                                onClick={resetSession}
                                className="text-xs text-slate-400 underline hover:text-rose-500"
                            >
                                Neuer Tag starten (Reset Heute)
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // --- ADDED FoodRouletteModal ---
        const FoodRouletteModal = ({ isOpen, onClose, selectedPlace, isSpinning, added, handleAddToFav }) => {
            if (!isOpen) return null;
            
            return (
                <div className="fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm modal-enter" onClick={onClose}>
                    <div className="bg-white dark:bg-slate-800 rounded-3xl w-full max-w-sm max-h-[90vh] overflow-y-auto p-6 text-center shadow-2xl relative border-4 border-amber-200 dark:border-amber-900" onClick={e => e.stopPropagation()}>
                        <button onClick={onClose} className="absolute top-4 right-4 p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full z-10"><Icon name="x" className="w-5 h-5 text-slate-400"/></button>
                        
                        <h3 className="text-xl font-bold text-amber-600 dark:text-amber-400 mb-4">Food Roulette üé∞</h3>
                        
                        {selectedPlace && (
                            <div className={`transition-opacity duration-200 ${isSpinning ? 'opacity-50 blur-sm' : 'opacity-100'}`}>
                                <div className="h-48 w-full rounded-xl overflow-hidden mb-4 relative shadow-inner group">
                                        <img src={selectedPlace.img} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" onError={(e) => e.target.src='https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=800&q=80'} />
                                        <div className="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                                        <div className="absolute bottom-2 left-2 text-white font-bold text-sm bg-black/30 px-2 py-1 rounded backdrop-blur-sm">
                                        {selectedPlace.subtag}
                                        </div>
                                </div>
                                
                                <h4 className="font-bold text-2xl text-slate-800 dark:text-white mb-2 leading-tight">{selectedPlace.title}</h4>
                                
                                <div className="flex justify-center gap-2 mb-4">
                                    <span className="text-xs font-bold px-2 py-1 bg-slate-100 dark:bg-slate-700 rounded text-slate-600 dark:text-slate-300 flex items-center gap-1">
                                        <Icon name="clock" className="w-3 h-3"/> {selectedPlace.time}
                                    </span>
                                    <span className="text-xs font-bold px-2 py-1 bg-slate-100 dark:bg-slate-700 rounded text-slate-600 dark:text-slate-300">
                                        Res: {selectedPlace.res}
                                    </span>
                                </div>

                                <p className="text-sm text-slate-600 dark:text-slate-300 mb-6 leading-relaxed bg-amber-50 dark:bg-amber-900/20 p-3 rounded-xl">
                                    {selectedPlace.desc}
                                </p>
                                
                                <div className="font-mono text-2xl text-amber-600 dark:text-amber-400 font-bold mb-6">
                                    ca. {selectedPlace.cost}.-
                                </div>
                            </div>
                        )}
                        
                        <button 
                            onClick={handleAddToFav} 
                            className={`w-full py-3.5 rounded-xl font-bold text-sm shadow-lg transition-all transform hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-2 ${
                                added 
                                ? 'bg-green-500 text-white hover:bg-green-600' 
                                : 'bg-slate-900 dark:bg-amber-600 text-white hover:bg-slate-800 dark:hover:bg-amber-500'
                            }`} 
                            disabled={isSpinning}
                        >
                            {isSpinning ? (
                                <>
                                    <Icon name="loader-2" className="w-4 h-4 animate-spin"/>
                                    Rolling...
                                </>
                            ) : (
                                added ? (
                                    <>
                                        <Icon name="check" className="w-4 h-4"/>
                                        Hinzugef√ºgt! ‚ù§Ô∏è
                                    </>
                                ) : (
                                    <>
                                        <Icon name="heart" className="w-4 h-4"/>
                                        Zu Favoriten ‚ù§Ô∏è
                                    </>
                                )
                            )}
                        </button>
                    </div>
                </div>
            );
        };

        // --- TripTimeline Component (Fixed) ---
        const TripTimeline = () => {
            const [progress, setProgress] = useState(0);

            useEffect(() => {
                const updateProgress = () => {
                    const now = new Date();
                    const start = new Date('2026-04-01T00:00:00');
                    const end = new Date('2026-04-10T23:59:59');
                    const totalDuration = end - start;

                    if (now < start) setProgress(0);
                    else if (now > end) setProgress(100);
                    else {
                        const elapsed = now - start;
                        setProgress((elapsed / totalDuration) * 100);
                    }
                };

                updateProgress();
                // Update every minute to allow "live" movement if page stays open
                const interval = setInterval(updateProgress, 60000);
                return () => clearInterval(interval);
            }, []);

            // Days array for rendering grid
            const days = [
                { date: '01.04', label: 'Mi' },
                { date: '02.04', label: 'Do' },
                { date: '03.04', label: 'Fr' },
                { date: '04.04', label: 'Sa' },
                { date: '05.04', label: 'So' },
                { date: '06.04', label: 'Mo' },
                { date: '07.04', label: 'Di' },
                { date: '08.04', label: 'Mi' },
                { date: '09.04', label: 'Do' },
                { date: '10.04', label: 'Fr' }
            ];

            return (
                <div className="w-full pt-8 pb-4 hidden md:block"> 
                    <div className="max-w-5xl mx-auto relative px-4">
                        {/* LABELS ROW */}
                        <div className="grid grid-cols-10 text-center text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wide mb-1">
                            {days.map((day, i) => (
                                <div key={i} className="flex flex-col items-center">
                                    <span className="text-xs mb-0.5">{day.label}</span>
                                    <span className="opacity-70">{day.date}</span>
                                </div>
                            ))}
                        </div>

                        {/* PROGRESS BAR TRACK */}
                        <div className="relative w-full h-3 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden shadow-inner mt-1">
                            {/* SEGMENTS BACKGROUND */}
                            <div className="absolute inset-0 flex h-full opacity-30">
                                <div className="w-[35%] bg-rose-300"></div> {/* Budapest 3.5 days */}
                                <div className="w-[30%] bg-amber-300"></div> {/* Vienna 3 days */}
                                <div className="w-[35%] bg-emerald-300"></div> {/* Prague 3.5 days */}
                            </div>
                            
                            {/* ACTIVE FILL */}
                            <div className="h-full bg-rose-500 dark:bg-rose-600 transition-all duration-1000 ease-linear shadow-lg relative z-10" style={{width: `${progress}%`}}></div>
                        </div>

                        {/* BEER CURSOR - Positioned exactly on the line */}
                        <div 
                            className="absolute top-[38px] text-2xl transition-all duration-1000 ease-linear beer-cursor z-20 filter drop-shadow-lg" 
                            style={{ left: `calc(${progress}% - 12px)`, marginTop: '-12px' }} 
                            title="Aktueller Pegelstand üç∫"
                        >
                            üç∫
                        </div>
                    </div>
                </div>
            );
        };

        const StaticAlternativesModal = ({ isOpen, onClose, currentItem }) => {
            const [alternatives, setAlternatives] = useState([]);

            useEffect(() => {
                if (isOpen && currentItem) {
                    let matches = DB.filter(i => 
                        i.city === currentItem.city && 
                        i.cat === currentItem.cat && 
                        i.id !== currentItem.id
                    );

                    matches.sort((a, b) => {
                        const aMatch = a.subtag === currentItem.subtag ? 1 : 0;
                        const bMatch = b.subtag === currentItem.subtag ? 1 : 0;
                        return bMatch - aMatch;
                    });

                    if (matches.length === 0) {
                        matches = DB.filter(i => i.city === currentItem.city && i.id !== currentItem.id);
                    }

                    setAlternatives(matches.slice(0, 4));
                }
            }, [isOpen, currentItem]);

            const openWebSearch = () => {
                const query = encodeURIComponent(`${currentItem.title} ${currentItem.city} alternative similar`);
                window.open(`https://www.google.com/search?q=${query}`, '_blank');
            };

            if (!isOpen || !currentItem) return null;

            return (
                <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm modal-enter" onClick={onClose}>
                    <div className="bg-white dark:bg-slate-800 rounded-3xl w-full max-w-xl max-h-[85vh] overflow-hidden shadow-2xl relative flex flex-col" onClick={e => e.stopPropagation()}>
                        
                        <div className="p-5 border-b border-rose-100 dark:border-slate-700 flex justify-between items-center bg-rose-50/50 dark:bg-slate-700/50">
                            <h2 className="text-lg font-bold text-rose-900 dark:text-rose-400">Alternativen zu "{currentItem.title}"</h2>
                            <button onClick={onClose} className="p-2 hover:bg-rose-100 dark:hover:bg-slate-600 rounded-full transition-colors"><Icon name="x" className="w-5 h-5 text-rose-400"/></button>
                        </div>

                        <div className="p-6 overflow-y-auto flex-1 custom-scroll bg-white dark:bg-slate-800">
                            <div className="space-y-3">
                                {alternatives.length > 0 ? alternatives.map(alt => (
                                    <div key={alt.id} className="border border-rose-100 dark:border-slate-700 rounded-2xl p-4 hover:border-rose-300 dark:hover:border-slate-500 hover:shadow-md transition-all bg-white dark:bg-slate-800">
                                        <div className="flex justify-between items-start mb-1">
                                            <h4 className="font-bold text-slate-800 dark:text-slate-200">{alt.title}</h4>
                                            <span className="text-xs font-mono font-bold text-rose-600 dark:text-rose-400 bg-rose-50 dark:bg-slate-700 px-2 py-1 rounded-lg">{alt.cost}.-</span>
                                        </div>
                                        <p className="text-xs text-slate-500 dark:text-slate-400 mb-2 line-clamp-2">{alt.desc}</p>
                                        <div className="flex gap-3 text-[10px] text-slate-400 font-bold uppercase tracking-wide">
                                            <span className="flex items-center gap-1"><Icon name="clock" className="w-3 h-3"/> {alt.time}</span>
                                            <span className="text-amber-600 dark:text-amber-500">{alt.res}</span>
                                        </div>
                                    </div>
                                )) : (
                                    <div className="text-center py-10 text-slate-400">Keine direkten Matches.</div>
                                )}
                            </div>
                        </div>

                        <div className="p-5 border-t border-rose-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
                            <button 
                                onClick={openWebSearch}
                                className="w-full py-3 bg-white dark:bg-slate-800 text-rose-600 dark:text-rose-400 text-sm font-bold rounded-xl flex items-center justify-center gap-2 hover:bg-rose-50 dark:hover:bg-slate-700 transition-colors border-2 border-rose-100 dark:border-slate-700 shadow-sm"
                            >
                                <Icon name="search" className="w-4 h-4"/> 
                                Google nach Weiterem fragen
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        const TripCalendar = () => {
            const initialDays = Array.from({ length: 10 }, (_, i) => {
                const date = new Date(2026, 3, 1 + i); 
                const dayStr = date.toLocaleDateString('de-DE', { weekday: 'short', day: '2-digit', month: '2-digit' });
                let city = "Budapest üá≠üá∫";
                let defaultSlots = { mor: "", aft: "", eve: "", nht: "" };

                if (i === 0) { 
                    defaultSlots.eve = "üõ¨ Landung 20:10 (EZS1213)";
                    defaultSlots.nht = "Check-in (ab 15:00)";
                } else if (i === 3) { 
                    city = "Budapest ‚û°Ô∏è Wien";
                    defaultSlots.mor = "Checkout BUD (bis 10:00)";
                    defaultSlots.aft = "Zug nach Wien";
                    defaultSlots.eve = "Check-in VIE (ab 15:00)";
                } else if (i > 3 && i < 6) {
                    city = "Wien üá¶üáπ";
                } else if (i === 6) { 
                    city = "Wien ‚û°Ô∏è Prag";
                    defaultSlots.mor = "Checkout VIE (bis 12:00)";
                    defaultSlots.aft = "Zug nach Prag";
                    defaultSlots.eve = "Check-in PRG (~15:00)";
                } else if (i > 6) {
                    city = "Prag üá®üáø";
                    if (i === 9) { 
                        defaultSlots.eve = "üõ´ Abflug 19:00 (EJU7572)";
                    }
                }

                return { id: i, date: dayStr, city, slots: defaultSlots };
            });

            const [days, setDays] = useState(() => {
                const saved = localStorage.getItem('trip_calendar_v2'); 
                return saved ? JSON.parse(saved) : initialDays;
            });

            useEffect(() => {
                localStorage.setItem('trip_calendar_v2', JSON.stringify(days));
            }, [days]);

            const updateSlot = (dayId, slot, value) => {
                setDays(prev => prev.map(d => d.id === dayId ? { ...d, slots: { ...d.slots, [slot]: value } } : d));
            };

            const resetCalendar = () => {
                if(confirm("Kalender zur√ºcksetzen? Alle eigenen Eintr√§ge gehen verloren.")) {
                    setDays(initialDays);
                }
            };

            return (
                <div className="p-4 pb-20 fade-in">
                    <div className="flex justify-center items-center mb-6 gap-4">
                         <h2 className="text-xl font-bold text-rose-900 dark:text-rose-400">Dein Reiseplan üìÖ</h2>
                         <button onClick={resetCalendar} className="text-[10px] text-slate-400 underline">Reset</button>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                        {days.map(day => (
                            <div key={day.id} className="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-rose-100 dark:border-slate-700 overflow-hidden flex flex-col">
                                <div className="bg-rose-50 dark:bg-slate-700 p-2 text-center border-b border-rose-100 dark:border-slate-600">
                                    <div className="font-bold text-rose-800 dark:text-rose-300">{day.date}</div>
                                    <div className="text-[10px] text-slate-500 dark:text-slate-400 uppercase tracking-wide">{day.city}</div>
                                </div>
                                <div className="p-2 space-y-2 flex-1">
                                    <textarea 
                                        placeholder="Morgen..." 
                                        className="w-full text-xs p-2 bg-slate-50 dark:bg-slate-900 rounded border border-slate-100 dark:border-slate-700 resize-none h-16 focus:border-rose-300 outline-none text-slate-800 dark:text-slate-200"
                                        value={day.slots.mor}
                                        onChange={(e) => updateSlot(day.id, 'mor', e.target.value)}
                                    />
                                    <textarea 
                                        placeholder="Nachmittag..." 
                                        className="w-full text-xs p-2 bg-slate-50 dark:bg-slate-900 rounded border border-slate-100 dark:border-slate-700 resize-none h-16 focus:border-rose-300 outline-none text-slate-800 dark:text-slate-200"
                                        value={day.slots.aft}
                                        onChange={(e) => updateSlot(day.id, 'aft', e.target.value)}
                                    />
                                    <textarea 
                                        placeholder="Abend..." 
                                        className="w-full text-xs p-2 bg-slate-50 dark:bg-slate-900 rounded border border-slate-100 dark:border-slate-700 resize-none h-16 focus:border-rose-300 outline-none text-slate-800 dark:text-slate-200"
                                        value={day.slots.eve}
                                        onChange={(e) => updateSlot(day.id, 'eve', e.target.value)}
                                    />
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const Card = ({ item, onShowAlternatives, toggleFav, isFav, onToast }) => {
            const [showLocal, setShowLocal] = useState(false);
            const [imgError, setImgError] = useState(false);

            const imagePath = `${item.img}`;

            const openSearch = (platform) => {
                const query = item.cat === "Transport" && item.city === "Transfer" 
                    ? item.desc.split('.')[0] 
                    : `${item.title} ${item.city}`;
                
                const encodedQuery = encodeURIComponent(query);

                if (platform === 'google') {
                    window.open(`https://www.google.com/search?q=${encodedQuery}`, '_blank');
                } else if (platform === 'tiktok') {
                    // Check if mobile
                    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                    
                    if (isMobile) {
                        navigator.clipboard.writeText(query).then(() => {
                            onToast(`Kopiert: "${query}" ‚úÖ - Jetzt in TikTok einf√ºgen!`);
                        });
                    } else {
                        window.open(`https://www.tiktok.com/search?q=${encodedQuery}`, '_blank');
                    }
                }
            };

            const openMaps = () => {
                // Logic to use lat/lng if available for better precision, else address
                if (item.lat && item.lng) {
                     window.open(`https://maps.google.com/?q=${item.lat},${item.lng}`, '_blank');
                } else {
                     const query = encodeURIComponent(item.address || `${item.title}, ${item.city}`);
                     window.open(`https://maps.google.com/?q=${query}`, '_blank');
                }
            };

            const getResBadge = (res) => {
                if(res.includes("Zwingend")) return "badge-res-high";
                if(res.includes("Empfohlen")) return "badge-res-med";
                return "badge-res-low";
            };

            const getLocalPrice = () => {
                let currency = 'CHF';
                let rate = 1;
                if (item.city === "Budapest") { currency = 'HUF'; rate = FX_RATES.HUF; }
                else if (item.city === "Wien") { currency = '‚Ç¨'; rate = FX_RATES.EUR; }
                else if (item.city === "Prag") { currency = 'Kƒç'; rate = FX_RATES.CZK; }
                
                const val = item.cost === "???" ? "???" : (item.cost * rate).toLocaleString(undefined, {maximumFractionDigits: 0});
                return `${val} ${currency}`;
            };

            let themeClass = "border-slate-200 dark:border-slate-700";
            let btnClass = "bg-slate-900 hover:bg-slate-800 dark:bg-slate-700 dark:hover:bg-slate-600";
            if (item.city === "Budapest") { themeClass = "border-rose-200 dark:border-rose-900"; btnClass = "bg-rose-600 hover:bg-rose-700 dark:bg-rose-800 dark:hover:bg-rose-700"; }
            if (item.city === "Wien") { themeClass = "border-amber-200 dark:border-amber-900"; btnClass = "bg-amber-600 hover:bg-amber-700 dark:bg-amber-800 dark:hover:bg-amber-700"; }
            if (item.city === "Prag") { themeClass = "border-emerald-200 dark:border-emerald-900"; btnClass = "bg-emerald-600 hover:bg-emerald-700 dark:bg-emerald-800 dark:hover:bg-emerald-700"; }
            if (item.city === "Transfer") { themeClass = "border-indigo-200 dark:border-indigo-900"; btnClass = "bg-indigo-600 hover:bg-indigo-700 dark:bg-indigo-800 dark:hover:bg-indigo-700"; }

            return (
                <div className={`bg-white dark:bg-slate-800 rounded-2xl shadow-sm border ${themeClass} overflow-hidden card-hover flex flex-col h-full fade-in relative group`}>
                    <div className="h-44 relative bg-slate-100 dark:bg-slate-700 overflow-hidden">
                        {!imgError && item.img ? (
                            <img src={imagePath} alt={item.title} className="w-full h-full object-cover transition-opacity duration-300" onError={() => setImgError(true)} />
                        ) : (
                            <div className="img-fallback" style={{display: 'flex', backgroundColor: '#e2e8f0', alignItems: 'center', justifyContent: 'center', color: '#94a3b8', fontWeight: 700, fontSize: '1.5rem', width: '100%', height: '100%'}}>
                                {item.title.substring(0, 2).toUpperCase()}
                            </div>
                        )}
                        <div className="absolute top-2 right-2 flex gap-1">
                            <span className="bg-white/90 dark:bg-slate-900/90 px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider text-slate-900 dark:text-slate-100 shadow-sm backdrop-blur-sm">{item.cat}</span>
                        </div>
                        <button 
                            onClick={(e) => { e.stopPropagation(); toggleFav(item.id); }}
                            className="absolute top-2 left-2 p-2 bg-white/80 dark:bg-slate-900/80 backdrop-blur rounded-full shadow-md hover:scale-110 transition-transform cursor-pointer z-20"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill={isFav ? "#f43f5e" : "none"} stroke={isFav ? "#f43f5e" : "#94a3b8"} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" 
                                className={`w-5 h-5 transition-all ${isFav ? 'heart-active' : ''}`}>
                                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                            </svg>
                        </button>
                    </div>

                    <div className="p-4 flex-1 flex flex-col">
                        <div className="flex justify-between items-start mb-2">
                            <h3 className="font-bold text-slate-900 dark:text-slate-100 text-lg leading-tight">{item.title}</h3>
                            <div 
                                className="text-right shrink-0 ml-2 cursor-pointer select-none" 
                                onClick={() => setShowLocal(!showLocal)}
                                title="Klick zum W√§hrung wechseln"
                            >
                                <div className="font-mono font-bold text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-900/30 px-2 py-1 rounded-lg text-sm transition-colors hover:bg-indigo-100">
                                    {showLocal ? getLocalPrice() : `${item.cost}.-`}
                                </div>
                            </div>
                        </div>

                        <p className="text-xs text-slate-500 dark:text-slate-400 mb-5 leading-relaxed flex-1">{item.desc}</p>

                        <div className="grid grid-cols-5 gap-2 mb-4">
                            <button onClick={() => openSearch('google')} className="col-span-2 py-2 bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-[10px] font-bold rounded-xl flex items-center justify-center gap-1 hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors border border-slate-100 dark:border-slate-600">
                                <GoogleIcon /> Google
                            </button>
                            {item.cat !== 'Transport' && (
                                <button onClick={() => openSearch('tiktok')} className="col-span-2 py-2 bg-white dark:bg-black text-black dark:text-white text-[10px] font-bold rounded-xl flex items-center justify-center gap-1 hover:bg-slate-50 dark:hover:bg-slate-900 transition-colors border border-slate-200 dark:border-slate-700">
                                    <TikTokIcon /> TikTok
                                </button>
                            )}
                             <button onClick={openMaps} className="col-span-1 py-2 bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-xl flex items-center justify-center hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors border border-slate-100 dark:border-slate-600" title="Karte">
                                <Icon name="map-pin" className="w-4 h-4"/>
                            </button>
                        </div>

                        <div className="border-t border-slate-50 dark:border-slate-700 pt-3 mt-auto space-y-3">
                            <div className="flex justify-between text-xs font-bold text-slate-400 uppercase tracking-wide">
                                <span className="flex items-center gap-1"><Icon name="clock" className="w-3 h-3"/> {item.time}</span>
                                <span className={`px-2 py-0.5 rounded ${getResBadge(item.res)}`}>Res: {item.res}</span>
                            </div>
                            
                            {item.cat !== 'Transport' && item.cat !== 'Hotel' && (
                                <button 
                                    onClick={() => onShowAlternatives(item)}
                                    className="w-full py-2.5 text-rose-600 dark:text-rose-400 bg-transparent border-2 border-rose-300 dark:border-rose-700 text-xs font-bold rounded-lg flex items-center justify-center gap-2 transition-all hover:bg-rose-50 dark:hover:bg-rose-900/20"
                                >
                                    <Icon name="sparkles" className="w-3 h-3 text-rose-400"/>
                                    Alternativen
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('hub');
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const [cityFilter, setCityFilter] = useState("Budapest");
            const [catFilter, setCatFilter] = useState("Alle");
            const [modalOpen, setModalOpen] = useState(false);
            const [modalItem, setModalItem] = useState(null);
            
            // Roulette State
            const [rouletteOpen, setRouletteOpen] = useState(false);
            const [selectedRoulettePlace, setSelectedRoulettePlace] = useState(null);
            const [isSpinning, setIsSpinning] = useState(false);
            const [rouletteAdded, setRouletteAdded] = useState(false);

            // Alcohol Tracker State
            const [trackerOpen, setTrackerOpen] = useState(false);
             // Emergency Modal State
            const [emergencyOpen, setEmergencyOpen] = useState(false);
            // Dark Mode & Drunk Mode State
            const [darkMode, setDarkMode] = useState(false);
            const [drunkMode, setDrunkMode] = useState(false);

            useEffect(() => {
                if (drunkMode) {
                     document.body.classList.add('drunk-mode');
                     document.documentElement.classList.add('dark');
                     setView('map'); // Force Map View
                } else {
                     document.body.classList.remove('drunk-mode');
                     if (!darkMode) {
                        document.documentElement.classList.remove('dark');
                     }
                }
                
                if (darkMode && !drunkMode) {
                    document.documentElement.classList.add('dark');
                    document.body.classList.add('bg-pattern-dark');
                    document.body.classList.remove('bg-pattern-light');
                } else if (!drunkMode) {
                    document.documentElement.classList.remove('dark');
                    document.body.classList.add('bg-pattern-light');
                    document.body.classList.remove('bg-pattern-dark');
                }
            }, [darkMode, drunkMode]);
            
            const [toastMsg, setToastMsg] = useState("");
            const [showToast, setShowToast] = useState(false);

            const triggerToast = (msg) => {
                setToastMsg(msg);
                setShowToast(true);
            };

            const triggerConfetti = () => {
                const duration = 2000;
                const end = Date.now() + duration;

                (function frame() {
                    confetti({
                        particleCount: 2,
                        angle: 60,
                        spread: 80,
                        origin: { x: 0 },
                        colors: ['#fb7185', '#fbbf24', '#34d399'],
                        scalar: 0.8
                    });
                    confetti({
                        particleCount: 2,
                        angle: 120,
                        spread: 80,
                        origin: { x: 1 },
                         colors: ['#fb7185', '#fbbf24', '#34d399'],
                         scalar: 0.8
                    });

                    if (Date.now() < end) {
                        requestAnimationFrame(frame);
                    }
                }());
            };
            
            const [favs, setFavs] = useState(() => {
                try {
                    const saved = localStorage.getItem('trip_favs');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) { return []; }
            });

            useEffect(() => {
                localStorage.setItem('trip_favs', JSON.stringify(favs));
            }, [favs]);

            const toggleFav = (id) => {
                setFavs(prev => prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id]);
            };

            const filteredDB = useMemo(() => {
                if (cityFilter === 'Favs') {
                    return DB.filter(item => favs.includes(item.id));
                }
                return DB.filter(item => {
                    if (cityFilter !== item.city) return false;
                    
                    // Drunk Mode Filter on List View too
                    if (drunkMode) {
                         const isHotel = item.cat === 'Hotel';
                         const isStreetFood = item.subtag === 'street';
                         if (!isHotel && !isStreetFood) return false;
                    }
                    
                    if (catFilter === "Alle") return true;
                    return item.cat === catFilter;
                });
            }, [cityFilter, catFilter, favs, drunkMode]);

            const handleShowAlternatives = (item) => {
                setModalItem(item);
                setModalOpen(true);
            };

            const toggleMenu = () => setIsMenuOpen(!isMenuOpen);
            
            const handleOpenRoulette = () => {
                setRouletteOpen(true);
                setIsSpinning(true);
                setRouletteAdded(false);
                
                const foodPlaces = DB.filter(item => item.city === cityFilter && item.cat === 'Essen');
                
                let count = 0;
                const maxCount = 20;
                const interval = setInterval(() => {
                    const random = foodPlaces[Math.floor(Math.random() * foodPlaces.length)];
                    setSelectedRoulettePlace(random);
                    count++;
                    if(count > maxCount) {
                        clearInterval(interval);
                        setIsSpinning(false);
                    }
                }, 100);
            }

            const handleRouletteAddToFav = () => {
                if (selectedRoulettePlace) {
                    toggleFav(selectedRoulettePlace.id);
                    setRouletteAdded(true);
                    setTimeout(() => setRouletteOpen(false), 1500);
                }
            };

            const [tripActive, setTripActive] = useState(false);
            const [daysLeft, setDaysLeft] = useState(0);
            // Passport Stamps State
    const [stamps, setStamps] = useState(() => {
    const saved = localStorage.getItem('passport_stamps');
    return saved ? JSON.parse(saved) : { BUD: false, VIE: false, PRG: false };
});

useEffect(() => {
    localStorage.setItem('passport_stamps', JSON.stringify(stamps));
}, [stamps]);

const checkStampUnlock = (userLat, userLng) => {
    const cityCoords = {
        BUD: [47.4979, 19.0402],
        VIE: [48.2082, 16.3738],
        PRG: [50.0755, 14.4378]
    };
    
    Object.entries(cityCoords).forEach(([code, [lat, lng]]) => {
        const distance = Math.sqrt(
            Math.pow(lat - userLat, 2) + Math.pow(lng - userLng, 2)
        ) * 111;
        
        if (distance < 20 && !stamps[code]) {
            setStamps(prev => ({ ...prev, [code]: true }));
            triggerConfetti();
            triggerToast(`üéâ Passport Stamp unlocked: ${code}!`);
        }
    });
};
            useEffect(() => {
                const now = new Date();
                const start = new Date('2026-04-01T00:00:00');
                const end = new Date('2026-04-10T23:59:59');
                
                const diffTime = start - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                setDaysLeft(diffDays);

                if (now >= start && now <= end) {
                    setTripActive(true);
                } else {
                    setTripActive(false);
                }
            }, []);
            // Make checkStampUnlock available globally for MapView
useEffect(() => {
    window.checkStampUnlock = checkStampUnlock;
    return () => {
        delete window.checkStampUnlock;
    };
}, [stamps]);

            const cities = ["Budapest", "Transfer", "Wien", "Prag"];

            return (
                <div className={`min-h-screen max-w-7xl mx-auto pb-20 transition-colors duration-500 ${darkMode ? 'text-slate-100' : 'text-slate-900'}`}>
                    <header className={`bg-white/80 dark:bg-slate-900/80 backdrop-blur-md p-4 sticky top-0 z-50 border-b border-rose-100 dark:border-slate-800 shadow-sm mb-6 rounded-b-[30px] transition-colors duration-300 ${drunkMode ? 'hidden' : ''}`}>
                        <div className="flex flex-col gap-4 max-w-7xl mx-auto">
                            <div className="flex flex-row justify-between items-center gap-4">
                                <div>
                                    <div className="flex items-center gap-2">
                                        <h1 className="text-xl font-bold tracking-tighter text-rose-900 dark:text-rose-400 flex items-center gap-2">
                                            Bingus & Amor <span className="bg-rose-100 dark:bg-rose-900 text-rose-600 dark:text-rose-200 text-[10px] px-2 py-0.5 rounded-full uppercase tracking-widest">Trip 2026</span>
                                        </h1>
                                    </div>
                                    <div className="hidden md:block">
                                        {tripActive ? (
                                            <div className="text-xs font-bold text-rose-500 animate-pulse">Der Trip l√§uft! üöÄ</div>
                                        ) : daysLeft > 0 ? (
                                            <div className="flex flex-col items-start">
                                                <span className="text-[10px] uppercase font-bold text-slate-400 dark:text-slate-500 tracking-wider mb-0.5">Countdown bis Abflug</span>
                                                <CountDown />
                                            </div>
                                        ) : (
                                            <div className="text-xs font-bold text-slate-400">Trip vorbei üëã</div>
                                        )}
                                    </div>
                                </div>
                                
                                <div className="hidden md:flex items-center gap-3">
                                   <CurrencyConverter city={cityFilter}/>
                                   
                                   <AlcoholTrackerButton onOpen={() => setTrackerOpen(true)} />

                                   <button 
                                        onClick={() => setDrunkMode(!drunkMode)} 
                                        className={`p-3 rounded-2xl border shadow-sm transition-all hover:scale-105 ${drunkMode ? 'bg-black border-neon-green text-neon-green' : 'bg-white dark:bg-slate-800 border-rose-100 dark:border-slate-700 text-slate-600 dark:text-yellow-400'}`}
                                        title="Drunk Mode"
                                   >
                                        <Icon name="ghost" className="w-4 h-4"/>
                                   </button>
                                   
                                   <button 
                                        onClick={() => setDarkMode(!darkMode)} 
                                        className="p-3 rounded-2xl bg-white dark:bg-slate-800 border border-rose-100 dark:border-slate-700 shadow-sm text-slate-600 dark:text-yellow-400 transition-all hover:scale-105"
                                        title={darkMode ? "Licht an" : "Licht aus"}
                                   >
                                        <Icon name={darkMode ? "sun" : "moon"} className="w-4 h-4"/>
                                   </button>

                                   <button 
                                        onClick={triggerConfetti} 
                                        className="px-4 py-2.5 rounded-2xl bg-gradient-to-r from-pink-500 to-rose-500 text-white font-bold shadow-lg hover:shadow-rose-500/30 transition-all hover:scale-105 active:scale-95 text-xs flex items-center gap-2 animate-pulse-slow"
                                        title="Konfetti Regen!"
                                   >
                                        <span>üéâ</span> HYPE!
                                   </button>
                                </div>
                                
                                <button className="md:hidden p-2" onClick={toggleMenu}>
                                    <Icon name={isMenuOpen ? "x" : "menu"} className="w-6 h-6 text-slate-700 dark:text-slate-200"/>
                                </button>
                            </div>
                        </div>

                         <div className="hidden md:block w-full">
                            <TripTimeline />
                         </div>

                         <div className="hidden md:flex gap-4 items-center">
                             <div className="flex gap-2">
                                <button onClick={() => setView('hub')} className={`px-4 py-2 rounded-lg font-bold text-sm transition-colors ${view === 'hub' ? 'bg-rose-50 dark:bg-rose-900/30 text-rose-700 dark:text-rose-300' : 'text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800'}`}>Hub</button>
                                <button onClick={() => setView('calendar')} className={`px-4 py-2 rounded-lg font-bold text-sm transition-colors ${view === 'calendar' ? 'bg-rose-50 dark:bg-rose-900/30 text-rose-700 dark:text-rose-300' : 'text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800'}`}>Kalender</button>
                                <button onClick={() => setView('map')} className={`px-4 py-2 rounded-lg font-bold text-sm transition-colors ${view === 'map' ? 'bg-rose-50 dark:bg-rose-900/30 text-rose-700 dark:text-rose-300' : 'text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800'}`}>Karte üó∫Ô∏è</button>
                             </div>
                             <div className="h-6 w-px bg-slate-200 dark:bg-slate-700"></div>
                             
                             {(view === 'hub' || view === 'map') && (
                                 <div className="flex gap-2 items-center w-full">
                                     <button onClick={() => { setCityFilter("Favs"); setCatFilter("Alle"); }} className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${cityFilter === "Favs" ? 'bg-rose-500 text-white' : 'text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800'}`}>‚ù§Ô∏è Favs</button>
                                     <div className="h-4 w-px bg-slate-200 dark:bg-slate-700"></div>
                                     {cities.map(c => (
                                         <button key={c} onClick={() => { setCityFilter(c); setCatFilter("Alle"); }} className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${cityFilter === c ? 'bg-slate-800 dark:bg-white text-white dark:text-slate-900' : 'text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800'}`}>
                                             {c === "Transfer" ? "üöÑ" : c.substring(0,3).toUpperCase()}
                                         </button>
                                     ))}
                                     
                                     {cityFilter !== "Transfer" && cityFilter !== "Favs" && (
                                         <div className="flex gap-2 ml-auto items-center">
                                             {["Alle", "Essen", "Aktivit√§t", "Party", "Hotel"].map(cat => (
                                                 <button key={cat} onClick={() => setCatFilter(cat)} className={`px-3 py-1 rounded-full text-[10px] font-bold border transition-colors whitespace-nowrap ${catFilter === cat ? 'bg-rose-100 dark:bg-rose-900/40 border-rose-300 dark:border-rose-700 text-rose-700 dark:text-rose-300' : 'bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 hover:border-slate-300'}`}>{cat}</button>
                                             ))}
                                             <div className="w-px h-4 bg-slate-200 dark:bg-slate-700 mx-1 flex-shrink-0"></div>
                                             <div className="flex-shrink-0">
                                                 <FoodRouletteButton spin={handleOpenRoulette} />
                                             </div>
                                         </div>
                                     )}
                                 </div>
                             )}
                         </div>
                    </header>
                    
                    {/* Drunk Mode Header Overlay */}
                    {drunkMode && (
                        <div className="fixed top-0 left-0 w-full z-[100] bg-black p-4 flex justify-between items-center border-b border-neon-green shadow-neon">
                             <div className="text-neon-green font-display text-2xl animate-pulse">DRUNK MODE ü•¥</div>
                             <button 
                                onClick={() => setDrunkMode(false)}
                                className="border border-neon-pink text-neon-pink px-4 py-2 rounded-xl font-bold uppercase tracking-widest hover:bg-neon-pink hover:text-black transition-colors"
                             >
                                 I'm Sober Now
                             </button>
                        </div>
                    )}
                    
                    {/* Mobile Menu */}
                    <div className={`overflow-hidden transition-all duration-300 md:hidden ${isMenuOpen ? 'max-h-[600px] border-t border-slate-100 dark:border-slate-700 mt-4 pt-4 px-4 bg-white/95 dark:bg-slate-900/95 backdrop-blur-lg fixed left-0 right-0 z-40 shadow-lg top-[70px]' : 'max-h-0'} ${drunkMode ? 'hidden' : ''}`}>
                        <div className="space-y-4 pb-4">
                            <div className="flex justify-between items-center">
                                <div className="text-xs text-rose-400 font-bold w-full">
                                     {tripActive ? "Der Trip l√§uft! üåç" : (daysLeft > 0 ? <div className="flex justify-between items-center w-full"><span>Countdown:</span><CountDown /></div> : "Trip vorbei üëã")}
                                </div>
                            </div>
                            
                            <div className="flex justify-between gap-2">
                                <button 
                                    onClick={() => setDrunkMode(!drunkMode)} 
                                    className={`p-2 rounded-xl border flex-1 flex items-center justify-center gap-2 text-xs font-bold ${drunkMode ? 'bg-black border-neon-green text-neon-green' : 'bg-slate-100 dark:bg-slate-800 border-slate-200 dark:border-slate-700'}`}
                                >
                                    <Icon name="ghost" className="w-4 h-4"/> Drunk Mode
                                </button>
                                <button 
                                    onClick={() => setDarkMode(!darkMode)} 
                                    className="p-2 rounded-xl bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 flex-1 flex items-center justify-center gap-2 text-xs font-bold"
                                >
                                    <Icon name={darkMode ? "sun" : "moon"} className="w-4 h-4"/> {darkMode ? "Light" : "Dark"}
                                </button>
                                <button 
                                    onClick={triggerConfetti} 
                                    className="p-2 rounded-xl bg-gradient-to-r from-pink-500 to-rose-500 text-white flex-1 flex items-center justify-center gap-2 text-xs font-bold"
                                >
                                    <span>üéâ</span> HYPE
                                </button>
                            </div>
{/* Passport Stamps */}
                                   <div className="flex items-center gap-2 bg-white/80 dark:bg-slate-800/80 backdrop-blur-md px-3 py-2 rounded-xl border border-rose-100 dark:border-slate-700 shadow-sm">
                                       {Object.entries(stamps).map(([code, unlocked]) => (
                                           <div 
                                               key={code} 
                                               className={`w-10 h-10 rounded-lg border-2 flex items-center justify-center font-black text-xs transition-all ${
                                                   unlocked 
                                                       ? 'bg-gradient-to-br from-rose-400 to-amber-400 border-amber-300 text-white shadow-lg scale-110' 
                                                       : 'bg-slate-100 dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-400 dark:text-slate-500'
                                               }`}
                                               title={unlocked ? `${code} Stamp unlocked!` : `Visit ${code} to unlock`}
                                           >
                                               {code}
                                           </div>
                                       ))}
                                   </div>
                            <CurrencyConverter city={cityFilter}/>
                            
                            <div className="flex justify-center">
                                <AlcoholTrackerButton onOpen={() => setTrackerOpen(true)} />
                            </div>

                            <div className="flex justify-center gap-2">
                                <button onClick={() => { setView('hub'); setIsMenuOpen(false); }} className={`flex-1 py-2 rounded-lg text-sm font-bold ${view === 'hub' ? 'bg-rose-500 text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300'}`}>Hub</button>
                                <button onClick={() => { setView('calendar'); setIsMenuOpen(false); }} className={`flex-1 py-2 rounded-lg text-sm font-bold ${view === 'calendar' ? 'bg-rose-500 text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300'}`}>Kalender</button>
                                <button onClick={() => { setView('map'); setIsMenuOpen(false); }} className={`flex-1 py-2 rounded-lg text-sm font-bold ${view === 'map' ? 'bg-rose-500 text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300'}`}>Karte</button>
                            </div>
                            
                            {(view === 'hub' || view === 'map') && (
                                <div className="space-y-3">
                                    <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                                        <button onClick={() => setCityFilter("Favs")} className={`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap ${cityFilter === "Favs" ? 'bg-rose-500 text-white' : 'bg-rose-50 dark:bg-slate-800 text-rose-600 dark:text-rose-400'}`}>‚ù§Ô∏è Favs</button>
                                        {cities.map(c => (
                                            <button key={c} onClick={() => setCityFilter(c)} className={`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap ${cityFilter === c ? 'bg-slate-800 dark:bg-white text-white dark:text-slate-900' : 'bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400'}`}>
                                                {c === "Transfer" ? "üöÑ" : c.toUpperCase()}
                                            </button>
                                        ))}
                                    </div>
                                    {cityFilter !== "Transfer" && cityFilter !== "Favs" && (
                                        <div className="flex gap-2 overflow-x-auto no-scrollbar items-center">
                                            {["Alle", "Essen", "Aktivit√§t", "Party", "Hotel"].map(cat => (
                                                <button key={cat} onClick={() => setCatFilter(cat)} className={`px-3 py-1.5 rounded-full text-[10px] font-bold border transition-colors whitespace-nowrap ${catFilter === cat ? 'bg-rose-100 dark:bg-rose-900/40 border-rose-300 dark:border-rose-700 text-rose-700 dark:text-rose-300' : 'bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 hover:border-slate-300'}`}>{cat}</button>
                                            ))}
                                            <div className="w-px h-4 bg-slate-200 dark:bg-slate-700 mx-1 flex-shrink-0"></div>
                                            <div className="flex-shrink-0">
                                                <FoodRouletteButton spin={handleOpenRoulette} />
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                    
                    <main className={`max-w-7xl mx-auto ${drunkMode ? 'pt-16' : ''}`}>
                        {view === 'hub' && !drunkMode ? (
                            <div className="p-4">
                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-6">
                                    {filteredDB.map(item => (
                                        <Card 
                                            key={item.id} 
                                            item={item} 
                                            onShowAlternatives={handleShowAlternatives} 
                                            toggleFav={toggleFav}
                                            isFav={favs.includes(item.id)}
                                            onToast={triggerToast}
                                        />
                                    ))}
                                </div>
                                {filteredDB.length === 0 && (
                                    <div className="text-center py-20 text-rose-300 dark:text-slate-600 flex flex-col items-center">
                                        <Icon name="heart-crack" className="w-12 h-12 mb-2 opacity-50"/>
                                        <p>Keine Eintr√§ge gefunden.</p>
                                    </div>
                                )}
                            </div>
                        ) : view === 'calendar' && !drunkMode ? (
                            <TripCalendar />
                        ) : (
                            <div className="p-4 fade-in h-full relative">
                                <div className={`rounded-3xl p-2 shadow-lg h-[80vh] border-4 ${drunkMode ? 'bg-black border-neon-green' : 'bg-white dark:bg-slate-800 border-white dark:border-slate-700'}`}>
                                    <MapView items={filteredDB} activeCity={cityFilter === 'Favs' ? 'Budapest' : cityFilter} drunkMode={drunkMode} />
                                </div>
                                {!drunkMode && (
                                    <div className="mt-4 text-center text-xs text-slate-400 dark:text-slate-500 font-bold bg-white/80 dark:bg-slate-800/80 inline-block px-4 py-2 rounded-full backdrop-blur-sm mx-auto flex flex-wrap justify-center border border-white dark:border-slate-700 gap-3">
                                        <span>ü•ê Fr√ºhst√ºck/Caf√©</span>
                                        <span>üçî Street Food</span>
                                        <span>ü•ò Restaurant</span>
                                        <span>üç∏ Party</span>
                                        <span>üè∞ Aktivit√§t</span>
                                        <span>üõèÔ∏è Hotel</span>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* FABs */}
                    {view !== 'calendar' && cityFilter !== 'Favs' && !drunkMode && (
    <>
        <EmergencyButton onClick={() => setEmergencyOpen(true)} />
        <SurvivalDictionary city={cityFilter} />
    </>
)}
                    {!drunkMode && <ChallengeButton />}
                    
                    {/* Render Modal at Root level */}
                    <AlcoholTrackerModal isOpen={trackerOpen} onClose={() => setTrackerOpen(false)} />
                    <FoodRouletteModal 
                        isOpen={rouletteOpen} 
                        onClose={() => setRouletteOpen(false)} 
                        selectedPlace={selectedRoulettePlace} 
                        isSpinning={isSpinning} 
                        added={rouletteAdded} 
                        handleAddToFav={handleRouletteAddToFav}
                    />

                    <StaticAlternativesModal isOpen={modalOpen} onClose={() => setModalOpen(false)} currentItem={modalItem} />
                    <EmergencyModal isOpen={emergencyOpen} onClose={() => setEmergencyOpen(false)} city={cityFilter} />
                    <Toast message={toastMsg} isVisible={showToast} onClose={() => setShowToast(false)} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
